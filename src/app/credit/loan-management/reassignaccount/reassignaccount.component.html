<div   class="ui-g">
    <div class="ui-g-12 no-padding">
        <div class="card no-padding">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-md-12">
                            <h2 i18n  class="panel-title pull-left">
                                Reassign Loan Account Manager
                            </h2>
                            <div class="pull-right">
                                    <button i18n  (click)="loanSearch()" pButton type="button" label="Loan Search" icon="fa-search"></button>
                                </div>
                        </div>
                    </div>
                </div>
                <div class="panel-body">
                    <div class="form-horizontal">
                        <div class="form-group">
                                <p-dataTable [value]="reasignedAccount" [paginator]="true" [rows]="15"   >
                                        <p-column i18n-header  field="loanReferneceNumber" header="Loan Reference Number" sortable="true" [filter]="true" filterMatchMode="contains"></p-column>

                                        <!-- <p-column i18n-header  field="productType" header="Product Type" sortable="true" [filter]="true" filterMatchMode="contains"></p-column> -->
                                        <p-column i18n-header  field="currentRMStaffName" header="Current RM" sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                                        <p-column i18n-header  field="startDate" header="Start Date " sortable="true" [filter]="true" filterMatchMode="contains">
                                                <ng-template let-col let-ln="rowData" pTemplate="body">
                                                        {{ln[col.field] | date }}
                                                    </ng-template>
                                        </p-column>
                                        <p-column i18n-header  field="endDate" header="End Date " sortable="true" [filter]="true" filterMatchMode="contains">
                                                <ng-template let-col let-ln="rowData" pTemplate="body">
                                                        {{ln[col.field] | date }}
                                                    </ng-template>
                                        </p-column>                                        
                                        <p-column i18n-header  field="newRMStaffName" header="New RM" sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                                        <p-column i18n-header  field="endDate" header="End Date" sortable="true" [filter]="true" filterMatchMode="contains">
                                                <ng-template let-col let-ln="rowData" pTemplate="body">
                                                        {{ln[col.field] | date }}
                                                    </ng-template>
                                        </p-column>
                                        
                                    </p-dataTable>
                        </div>
                    </div>
                </div>
                <!--end of panel-->
            </div>
        </div>
    </div>
</div>
<p-dialog [responsive]=true [(visible)]="displayData" id="add-modal" modal="modal" showEffect="fade" width="1200">

    <div  class="ui-g">
        <div class="ui-g-12 no-padding">
            <div class="card no-padding">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <div class="row">
                            <div class="col-md-12">
                                <h2 i18n  class="panel-title pull-left">
                                    Reassign Loan Account Manager
                                </h2>    
                                             
                            </div>
                        </div>
                    </div>
                    <div class="panel-body">
                        <div class="form-horizontal">
                            <form novalidate [formGroup]="runningLoansForm" autocomplete="off">
                                <div class="form-group">
                                    <label i18n  for="loanReferenceNumber" class="control-label col-md-2">Loan Reference Number</label>
                                    <div class="col-md-4 ">
                                        <input type="text" [attr.disabled]=true name="loanReferenceNumber" formControlName="loanReferenceNumber" id="loanReferenceNumber"
                                            class="form-control" [ngClass]="!runningLoansForm.controls['loanReferenceNumber'].valid ? 'required-input' : 'valid-input'">
                                    </div>
                                    <label i18n  for="" class="control-label col-md-2">Principal Amount</label>
                                    <div class="col-md-4 ">
                                        <input type="text" [attr.disabled]=true name="approvedAmount" formControlName="approvedAmount" id="approvedAmount" class="form-control"
                                            [ngClass]="!runningLoansForm.controls['approvedAmount'].valid ? 'required-input' : 'valid-input'">
                                    </div>

                                </div>
                                <div class="form-group">
                                    <label i18n  for="outstandingPrincipal" class="control-label col-md-2">Outstanding Principal</label>
                                    <div class="col-md-4 ">
                                        <input type="text" [attr.disabled]=true name="outstandingPrincipal" formControlName="outstandingPrincipal" id="outstandingPrincipal"
                                            class="form-control" [ngClass]="!runningLoansForm.controls['outstandingPrincipal'].valid ? 'required-input' : 'valid-input'">
                                    </div>
                                    <label i18n  for="interestRate" class="control-label col-md-2">Interest Rate</label>
                                    <div class="col-md-4 ">
                                        <input type="text" [attr.disabled]=true name="interestRate" formControlName="interestRate" id="interestRate" class="form-control"
                                            [ngClass]="!runningLoansForm.controls['interestRate'].valid ? 'required-input' : 'valid-input'">
                                    </div>

                                </div>

                                <div class="form-group">
                                    <label i18n  for="teno" class="control-label col-md-2">Tenor</label>
                                    <div class="col-md-4 ">
                                        <input type="text" [attr.disabled]=true name="teno" formControlName="teno" id="teno" class="form-control" [ngClass]="!runningLoansForm.controls['teno'].valid ? 'required-input' : 'valid-input'">
                                    </div>

                                    <label i18n  for="accrualedAmount" class="control-label col-md-2">Accrued Interest</label>
                                    <div class="col-md-4 ">
                                        <input type="text" [attr.disabled]=true name="accrualedAmount" formControlName="accrualedAmount" id="accrualedAmount" class="form-control"
                                            [ngClass]="!runningLoansForm.controls['accrualedAmount'].valid ? 'required-input' : 'valid-input'">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label i18n  for="currency" class="control-label col-md-2">Currency</label>
                                    <div class="col-md-4 ">
                                        <input type="text" [attr.disabled]=true name="currency" formControlName="currency" id="currency" class="form-control" [ngClass]="!runningLoansForm.controls['currency'].valid ? 'required-input' : 'valid-input'">
                                    </div>

                                    <label i18n  for="pastDueTotal" class="control-label col-md-2">Past Due</label>
                                    <div class="col-md-4 ">
                                        <input type="text" [attr.disabled]=true name="pastDueTotal" formControlName="pastDueTotal" id="pastDueTotal" class="form-control"
                                            [ngClass]="!runningLoansForm.controls['pastDueTotal'].valid ? 'required-input' : 'valid-input'">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label i18n  for="totalAmount" class="control-label col-md-2">Total Amount</label>
                                    <div class="col-md-4 ">
                                        <input type="text" [attr.disabled]=true name="totalAmount" formControlName="totalAmount" id="totalAmount" class="form-control"
                                            [ngClass]="!runningLoansForm.controls['totalAmount'].valid ? 'required-input' : 'valid-input'">
                                    </div>

                                    <label i18n  *ngIf="displayEffectiveDate" for="previousEffectiveDate" class="control-label col-md-2">Effective Date </label>
                                    <div *ngIf="displayEffectiveDate" class="col-md-4">
                                        <p-calendar id="previousEffectiveDate" formControlName="previousEffectiveDate" dateFormat="dd/mm/yy" [ngClass]="'valid-input'"
                                            [inputStyle]="{'width': '270px' }" [monthNavigator]="true" [yearNavigator]="true" readOnlyInputText="true"
                                            yearRange="2000:2990" [showIcon]="true"></p-calendar>
                                    </div>


                                </div>

                                <div class="form-group">
                                    <label i18n  for="relationshipManagerName" class="col-md-2">Relationship Manager</label>
                                    <div class="col-md-4">
                                        <input type="text" [attr.disabled]=true name="relationshipManagerName" formControlName="relationshipManagerName" class="form-control"
                                            [ngClass]="!runningLoansForm.controls['relationshipManagerName'].valid ? 'required-input' : 'valid-input'">

                                    </div>


                                    <label i18n  for="relationshipOfficerName" class="col-md-2">Relationship Officer</label>
                                    <div class="col-md-4">
                                        <input type="text" [attr.disabled]=true name="relationshipOfficerName" formControlName="relationshipOfficerName" class="form-control"
                                            [ngClass]="!runningLoansForm.controls['relationshipOfficerName'].valid ? 'required-input' : 'valid-input'">

                                    </div>
                                </div>
                                <div>
                                    <h3>
                                        Assign Relationship Manager
                                    </h3>
                                    <div class="form-group">
                                        <label i18n  for="" class="col-md-2"></label>
                                        <div class="col-md-4">
                                            <select name="" id="" class="form-control" formControlName="newRMStaffId" 
                                            [ngClass]="!runningLoansForm.controls['newRMStaffId'].valid ? 'required-input' : 'valid-input'">
                                                <option i18n  value="">Select RM...</option>
                                                <option *ngFor="let item of officers" value="{{item.staffId}}">{{item.fullName}}</option>
                                            </select>
                                        </div>

                                        <label i18n  for="" class="col-md-2">Effective Date </label>
                                        <div class="col-md-4">
                                            <p-calendar id="previousEffectiveDate" dateFormat="dd/mm/yy" [ngClass]="!runningLoansForm.controls['effectFrom'].valid ? 'required-input' : 'valid-input'"
                                                [inputStyle]="{'width': '270px' }" formControlName="effectFrom" [monthNavigator]="true"
                                                [yearNavigator]="true" readOnlyInputText="true" yearRange="2000:2990" [showIcon]="true"></p-calendar>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label i18n  for="" class="control-label col-md-2">
                                            Reason For Change
                                        </label>
                                        <div class="col-md-4">
                                            <textarea   class="form-control" id="reasonForChange" formControlName="reasonForChange"  rows="6"
                                            [ngClass]="!runningLoansForm.controls['reasonForChange'].valid ? 'required-input' : 'valid-input'">
                                        </textarea>
                                            
                                        </div>

                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                
                    <!--end of panel-->
                </div>
                <div class="panel-footer">
                    <div class="row">
                        <div class="col-md-12">
                            <button i18n  type="button" (click)="submitForm()" [disabled]="runningLoansForm.invalid" class="btn btn-success pull-right">Save</button>
                            <button i18n  type="button" (click)="backToSearch()" style="margin-right:5px" class="btn btn-danger pull-right">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</p-dialog>

<!-- LOAN SEARCH FORM -->
<p-dialog [responsive]=true [(visible)]="displayLoanSearch" id="add-modal" modal="modal" showEffect="fade" width="1200">

        <div style="margin-bottom:0" class="panel panel-default">
    
            <div class="panel-heading">
                <h2 i18n  class="panel-title"> Loan Search</h2>
                <div class="pull-right">
                    <a class="close" (click)="closeLoanSearch()">&times;</a>
                </div>
            </div>
    
            <div class="panel-body">   
             
    
                        <form novalidate [formGroup]="loanSearchForm" autocomplete="off">
                            <div class="panel-body">
    
                                <div class="form-horizontal">
                                    <div class="form-group">
                                        <label i18n  for="operationTypeId" class="control-label col-md-12">Facility Type</label>
                                        <div class="col-md-6">
                                            <select name="productTypeId" [(ngModel)]="accountTypeId" formControlName="productTypeId" id="operationTypeId" class="form-control" [ngClass]="loanSearchForm.controls['productTypeId'].valid ? 'valid-input' : 'required-input'">
                                                <option i18n  value="">-- Select Facility Type --</option>
                                                <option  *ngFor="let x of productTypes" [value]="x.id">{{ x.name }}</option>
                                            </select>
                                        </div>
                                        <div class="col-md-6 input-group">
                                            <input type="text" name="searchString" formControlName="searchString" id="searchString" class="form-control" placeholder="Enter Customer Name, CASA Account number or Loan Reference Number"
                                                [ngClass]="!loanSearchForm.controls['searchString'].valid ? 'required-input' : 'valid-input'">
    
                                            <span (click)="submitLoanSearchForm(loanSearchForm)" class="input-group-addon btn btn-info">
                                                <span class="glyphicon glyphicon-search"></span><ng-container i18n> Search</ng-container>
                                            </span>
                                        </div>
    
                                    </div>
                                </div>
    
                            </div>
                        </form>
    
    
                        <p-dataTable [value]="loans" [paginator]="true" [rows]="5" [(selection)]="Selectedloan" dataKey="loanId" (onRowSelect)="onSelectedLoanChange()">
                            <p-column i18n-header  [style]="{'width':'38px'}" selectionMode="single"></p-column>
    
                            <p-column i18n-header  field="loanReferenceNumber" header="Loan Reference Number" sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                            <p-column i18n-header  field="productName" header="Product Name" sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                            <p-column i18n-header  field="customerName" header="Customer Name" sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
    
                            <p-column i18n-header  field="principalAmount" header="Principal Amount" sortable="true" [filter]="true" filterMatchMode="contains">
                                <ng-template let-d="rowData" let-i="rowIndex" pTemplate="body">
                                    {{ d.principalAmount | number : '1.2' }}
                                </ng-template>
                            </p-column>
    
                            <!-- interestRate = l.INTERESTRATE,
    
                            effectiveDate = l.EFFECTIVEDATE,
                            maturityDate = l.MATURITYDATE,
                            bookingDate = l.BOOKINGDATE,
    
                            principalAmount = l.PRINCIPALAMOUNT, -->
    
                            <!--<p-column i18n-header > 
                                <ng-template pTemplate="header">Actions</ng-template>
                                <ng-template let-d="rowData" let-i="rowIndex" pTemplate="body">
                                    <a (click)="viewCustomerDetails(i)" href="javascript:void(0)">View Details</a>
                                </ng-template>
                            </p-column>-->
    
                        </p-dataTable>
    
                   
            </div>
    
        </div>
    
    </p-dialog>
    <!--end of form modal-->