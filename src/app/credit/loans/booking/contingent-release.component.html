<div class="ui-g">
    <div class="ui-g-12 no-padding">
        <div class="card no-padding">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-md-12">
                            <h2 class="panel-title pull-left">
                                <ng-container i18n>Contingent Facility Release</ng-container>
                                <span *ngIf="loanSelection != null && loanSelection.loanTypeId == 3">{{loanSelection.applicantName}}</span>
                                <span *ngIf="loanSelection != null && loanSelection.loanTypeId != 3">{{loanSelection.customerName}}</span>
                            </h2>
                        </div>
                    </div>
                </div>

                <div class="panel-body">
                    <div *ngIf="displayLoanList" class="card no-padding">
                        <div class="card no-padding">  
                            <p-dataTable [paginator]="true" [responsive]="true" [value]="loans" [(selection)]="loanSelection" selectionMode="single"
                                [rows]="10" (onRowSelect)="onSelectedLoanChange($event)" [scrollable]="true" scrollWidth="auto">
                                <p-column [style]="{'width':'38px'}">
                                    <ng-template  pTemplate="body">
                                        <a  style="display: block" href="javascript:void(0)">
                                            <i class="glyphicon glyphicon-eye-open"></i>
                                        </a>
                                    </ng-template>
                                </p-column>
                                <p-column i18n-header [style]="{'width':'70px'}" field="divisionShortCode" header="Unit" sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                                <p-column i18n-header field="systemArrivalDateTime" [style]="{'width':'90px'}" header="Arrival Date" sortable="true" [filter]="true" filterMatchMode="contains">
                                <ng-template let-i="rowIndex" let-row="rowData" pTemplate type="body">
                                    {{ row.systemArrivalDateTime | date: 'medium' }}
                                </ng-template>
                                </p-column>
                                <p-column i18n-header field="productTypeName" [style]="{'width':'107px'}" header="Facility Type" sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                                <p-column i18n-header [style]="{'width':'95px'}" field="applicationReferenceNumber" header="Ref No" sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                                <p-column i18n-header [style]="{'width':'50px'}" field="isLineFacilityString" header="Is A Line"
                                    sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                                <p-column i18n-header field="applicantName" [style]="{'width':'150px'}" header="Obligor's Name" sortable="true" [filter]="true" filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        <span *ngIf="item.loanTypeId == 1">{{item.customerName}}</span>
                                        <span *ngIf="item.loanTypeId != 1">{{item.customerName}} ({{item.customerGroupName}})</span>
                                    </ng-template>
                                </p-column>
                                <p-column i18n-header [style]="{'text-align':'right','width':'120px'}" field="approvedAmount" header="Approved Amount" sortable="true"
                                    [filter]="true" filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        {{item.approvedAmount | currency:item.currencyCode:true:'1.2-2'}}
                                    </ng-template>
                                </p-column>
                                <p-column i18n-header [style]="{'text-align':'right','width':'120px'}" field="bookingAmountRequested" header="Requested Amount" sortable="true"
                                    [filter]="true" filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        {{item.bookingAmountRequested | currency:item.currencyCode:true:'1.2-2'}}
                                    </ng-template>
                                </p-column> 
                                <p-column i18n-header [style]="{'text-align':'right','width':'120px'}" field="amountDisbursed" header="Disbursed Amount" sortable="true"
                                [filter]="true" filterMatchMode="contains">
                                <ng-template pTemplate="body" let-item="rowData">
                                    {{item.amountDisbursed | currency:item.currencyCode:true:'1.2-2'}}
                                </ng-template>
                            </p-column>
                                <p-column i18n-header [style]="{'text-align':'right','width':'120px'}" field="customerAvailableAmount" header="Available Amount" sortable="true"
                                    [filter]="true" filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        {{item.customerAvailableAmount | currency:item.currencyCode:true:'1.2-2'}}
                                    </ng-template>
                                </p-column> 
                                <p-column i18n-header [style]="{'width':'65px'}" field="interestRate" header="Rate" [filter]="true" filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                       <span *ngIf="item.productPriceIndex != null || item.productPriceIndex != undefined ">{{item.interestRate}}  ({{item.productPriceIndex.substring(0,3)}}) </span>
                                       <span *ngIf="item.productPriceIndex == null ">{{item.interestRate}} </span>
                                    </ng-template>
                                </p-column>
                                <p-column i18n-header [style]="{'width':'80px'}" field="approvedTenor" header="Tenor" sortable="true" [filter]="true" filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        {{item.approvedTenorString}} 
                                    </ng-template>
                                </p-column> 
                                <p-column i18n-header [style]="{'width':'60px'}" field="requestStaffId" header="Status">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        <span i18n *ngIf="item.toStaffId != null && item.toStaffId == userInfo.staffId && item.approvalStatusId != referredId" class="glyphicon glyphicon-share-alt label label-warning">Pending</span>
                                        <span i18n *ngIf="item.toStaffId != null && item.toStaffId != userInfo.staffId && item.approvalStatusId != referredId" class="glyphicon glyphicon-share-alt label label-info">Routed</span>
                                        <span i18n *ngIf="item.toStaffId == null && item.approvalStatusId != referredId" class="label label-warning">Pending</span>
                                        <span i18n *ngIf="item.approvalStatusId == referredId" class="label label-primary">Referred</span>
                                    </ng-template>
                                </p-column>
                            </p-dataTable>
                         </div> 
                    </div> 
                    <div *ngIf="displayBookedLoans" class="card no-padding">
                        <form novalidate [formGroup]="loanBookingForm" autocomplete="off">
                            <p-tabView (onChange)="onTabChange($event)">
                                <p-tabPanel i18n-header  header="Customer Information">
                                        <p-accordion *ngIf="loanSelection.canReRouteBooking" #accordion2>
                                                <p-accordionTab i18n-header header="Show Facility Routing" >
                                                    <app-workflow-routing 
                                                        [currentSelection]="workflowTarget" 
                                                        [enableRoutePreset]="false" 
                                                        [enableReroute]="enableReroute" 
                                                        [panelLabel]="'Facility Booking Routing'"
                                                        [referenceNumber]="loanSelection?.applicationReferenceNumber" 
                                                        (rerouted)="resetGrid($event)"
                                                    ></app-workflow-routing>
                                                </p-accordionTab>
                                            </p-accordion>
                                        
                                    <p-accordion #accordion>
                                        <p-accordionTab i18n-header [selected]="true" header="Overview">
                                            <table class="table table-customer-information">
                                                <tbody>
                                                    <tr>
                                                        <td>
                                                            <strong i18n>Customer Name</strong>
                                                        </td>
                                                        <td>
                                                            <span>{{loanSelection.customerName}} </span>
                                                            <!-- <span *ngIf="isGroup">{{loanSelection.customerName}} <strong  >({{loanSelection.customerGroupName}})</strong> </span> -->
                                                        </td>
                                                        <td>
                                                            <strong i18n>Customer Code</strong>
                                                        </td>
                                                        <td>{{ customerCode ? customerCode : 'N/A' }}</td>
                                                    </tr>
                                                    <tr>
                                                        <td>
                                                            <strong i18n>Application Reference Number</strong>
                                                        </td>
                                                        <td>{{ loanSelection.applicationReferenceNumber }}</td>
                                                        <td>
                                                            <strong i18n>Product </strong>
                                                        </td>
                                                        <td>{{ loanSelection.productName }}</td>
                                                    </tr>
                                                    <tr>
                                                        <td>
                                                            <strong i18n>Loan Facility Type</strong>
                                                        </td>
                                                        <td>{{ loanSelection.productTypeName }}</td>
                                                        <td>
                                                            <strong i18n>Loan Type</strong>
                                                        </td>
                                                        <td>{{ loanSelection.loanTypeName }}</td>
                                                    </tr>
                                                    <tr>
                                                        <td>
                                                            <strong i18n>Is Related Party</strong>
                                                        </td>
                                                        <td i18n *ngIf="loanSelection.isRealatedParty"> Yes</td>
                                                        <td i18n *ngIf="!loanSelection.isRealatedParty"> No</td>
                                                        <td>
                                                            <strong i18n>Politically Exposed?</strong>
                                                        </td>
                                                        <td i18n *ngIf="loanSelection.isPoliticallyExposed"> Yes</td>
                                                        <td i18n *ngIf="!loanSelection.isPoliticallyExposed"> No</td>
                                                    </tr>
                                                    <tr>
                                                        <td>
                                                            <strong i18n>Type of Customer</strong>
                                                        </td>
                                                        <td>{{ loanSelection.customerType }}</td>
                                                        <td>
                                                            <strong i18n>Branch</strong>
                                                        </td>
                                                        <td>{{ loanSelection.branchName }}</td>
                                                    </tr>
                                                    <tr *ngIf="isCommercialLoan">
                                                        <td>
                                                            <strong i18n>Receiving Account</strong>
                                                        </td>
                                                        <td>
                                                            <select (change)="onCustomerAccountChange($event.target.value)" name="casaAccountId" id="casaAccountId" formControlName="casaAccountId"
                                                                class="form-control" [ngClass]="!loanBookingForm.controls['casaAccountId'].valid ? 'required-input' : 'valid-input'">
                                                                <option value="" i18n>-- Select Customer Account --</option>
                                                                <option *ngFor="let x of loanSelection.customerAccounts" [value]="x.casaAccountId">{{ x.productAccountNumber }}</option>
                                                            </select>
                                                        </td>
                                                        <td>
                                                            <strong i18n> Paying Account</strong>
                                                        </td>
                                                        <td>
                                                            <select (change)="onCustomerAccountChange($event.target.value)" name="casaAccountId2" id="casaAccountId2" formControlName="casaAccountId2"
                                                                class="form-control" [ngClass]="!loanBookingForm.controls['casaAccountId2'].valid ? 'required-input' : 'valid-input'">
                                                                <option value="" i18n>-- Select Customer Account --</option>
                                                                <option *ngFor="let x of loanSelection.customerAccounts" [value]="x.casaAccountId">{{ x.productAccountNumber }}</option>
                                                            </select>
                                                        </td>
                                                    </tr>

                                                    <tr *ngIf="isForeignExchangeLoan">
                                                        <td>
                                                            <strong i18n>Interest CAP Account</strong>
                                                        </td>
                                                        <td>
                                                            <select (change)="onCustomerAccountChange($event.target.value)" name="casaAccountId" id="casaAccountId" formControlName="casaAccountId"
                                                                class="form-control" [ngClass]="!loanBookingForm.controls['casaAccountId'].valid ? 'required-input' : 'valid-input'">
                                                                <option value="" i18n>-- Select Customer Account --</option>
                                                                <option *ngFor="let x of interestCapAccount" [value]="x.casaAccountId">{{ x.productAccountNumber }}</option>
                                                            </select>
                                                        </td>
                                                        <td>
                                                            <strong i18n> Nostro Account</strong>
                                                        </td>
                                                        <td>
                                                            <select (change)="onNostroAccountChange($event.target.value)" name="casaAccountId2" id="casaAccountId2" formControlName="casaAccountId2"
                                                                class="form-control" [ngClass]="!loanBookingForm.controls['casaAccountId2'].valid ? 'required-input' : 'valid-input'">
                                                                <option value="" i18n>-- Select Nostro Account --</option>
                                                                <option *ngFor="let x of nostroAccounts" [value]="x.customAccountId">{{ x.detail }}</option>
                                                            </select>
                                                        </td>
                                                    </tr>
                                                    <tr *ngIf="isForeignExchangeLoan">
                                                        <td>
                                                            <strong i18n>Rate Code</strong>
                                                        </td>
                                                        <td>
                                                            <select (change)="getExchangeRate()" name="nostroRateCodeId" id="nostroRateCodeId" formControlName="nostroRateCodeId"
                                                                class="form-control" [ngClass]="!loanBookingForm.controls['nostroRateCodeId'].valid ? 'required-input' : 'valid-input'">
                                                                <option value="" i18n>-- Select Rate Code --</option>
                                                                <option *ngFor="let x of rateCodes" [value]="x.lookupId">{{ x.lookupName }}</option>
                                                            </select>
                                                        </td>
                                                        <td ><strong i18n> Rate Amount</strong></td>
                                                        <td ><input type="text" formControlName="nostroRateAmount" name="nostroRateAmount" [ngClass]="!loanBookingForm.controls['nostroRateAmount'].valid ? 'required-input' : 'valid-input'" class="form-control"></td>
                                                    </tr>
                                                    <tr *ngIf="isForeignExchangeLoan">
                                                            <td *ngIf="destinationCurrencyCode != null">
                                                                <strong> {{destinationCurrencyCode}} Rate</strong>
                                                            </td>
                                                            <td *ngIf="destinationCurrencyCode != null && destinationCurrencyAmount > 0 ">
                                                               {{destinationCurrencyAmount | currency:destinationCurrencyCode:true:'1.2-2'}} <span> (@{{sellingRate}})</span>
                                                            </td>
                                                    </tr>

                                                    <tr *ngIf="!isCommercialLoan && !isForeignExchangeLoan && isIDF">
                                                        <td>
                                                            <strong i18n>Customer Account</strong>
                                                        </td>
                                                        <td>
                                                            <strong i18n>Receiving Account</strong>
                                                        </td>
                                                        <td>
                                                            <select (change)="onCustomerAccountChange($event.target.value)" name="casaAccountId" id="casaAccountId" formControlName="casaAccountId"
                                                                class="form-control" [ngClass]="!loanBookingForm.controls['casaAccountId'].valid ? 'required-input' : 'valid-input'">
                                                                <option value="" i18n>-- Select Customer Account --</option>
                                                                <option *ngFor="let x of loanSelection.customerAccounts" [value]="x.casaAccountId">{{ x.productAccountNumber }}</option>
                                                            </select>
                                                        </td>
                                                        <td>
                                                            <strong i18n> Collection Account</strong>
                                                        </td>
                                                        <td>
                                                            <select (change)="onCustomerAccountChange($event.target.value)" name="casaAccountId2" id="casaAccountId2" formControlName="casaAccountId2"
                                                                class="form-control" [ngClass]="!loanBookingForm.controls['casaAccountId2'].valid ? 'required-input' : 'valid-input'">
                                                                <option value="" i18n>-- Select Collection Account --</option>
                                                                <option *ngFor="let x of loanSelection.customerAccounts" [value]="x.casaAccountId">{{ x.productAccountNumber }}</option>
                                                            </select>
                                                        </td>
                                                    </tr>
                                                    <tr *ngIf="!isCommercialLoan && !isForeignExchangeLoan && !isIDF">
                                                        <td>
                                                            <strong i18n>Sector</strong>
                                                        </td>
                                                        <td>{{ loanSelection.sectorSubSectorName }}</td>
                                                        <td>
                                                            <strong i18n> Customer Account</strong>
                                                        </td>
                                                        <td>
                                                            <select (change)="onCustomerAccountChange($event.target.value)" name="casaAccountId" id="casaAccountId" formControlName="casaAccountId"
                                                                class="form-control" [ngClass]="!loanBookingForm.controls['casaAccountId'].valid ? 'required-input' : 'valid-input'">
                                                                <option value="" i18n>-- Select Customer Account --</option>
                                                                <option *ngFor="let x of loanSelection.customerAccounts" [value]="x.casaAccountId">{{ x.productAccountNumber }}</option>
                                                            </select>
                                                        </td>
                                                    </tr>
                                                    
                                                    <tr *ngIf="loanSelection.productTypeName.toLowerCase() === 'commercial loans'">
                                                        <td>
                                                            <strong i18n>Sector</strong>
                                                        </td>
                                                        <td>{{ loanSelection.sectorSubSectorName }}</td>
                                                        <td>
                                                            <strong> </strong>
                                                        </td>
                                                        <td></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                            <div class="row">
                                                <label i18n for="" class="control-label col-md-2">Legal Reference Number</label>
                                                <div class="col-md-10">
                                                    <input type="text" style="width:300px;" (blur)="verifyLegalContingentCode()" formControlName="legalContingentCode" name="legalContingentCode" [ngClass]="!loanBookingForm.controls['legalContingentCode'].valid ? 'required-input' : 'valid-input'" class="form-control" >
                                                    <!-- <input type="text" (blur)="verifyLegalContingentCode($event,loanSelection.loanApplicationDetailId)" formControlName="legalContingentCode" name="legalContingentCode" [ngClass]="!loanBookingForm.controls['legalContingentCode'].valid ? 'required-input' : 'valid-input'" class="form-control" > -->
                                                
                                                </div>
                                            </div>
                                       
                                        </p-accordionTab>
                                        <p-accordionTab i18n-header header="Customer Information">
                                            <div class="panel-body" style="overflow:auto; height:350px">
                                                <app-customer-information-detail [loadWithCustomerId]="loanSelection.customerId">
                                                </app-customer-information-detail>
                                            </div>
                                        </p-accordionTab>
                                    </p-accordion>
                                </p-tabPanel >
                                <p-tabPanel i18n-header  header="Form 3800B" [disabled]="isLoanInfoDisabled">
                                    <div class="row">
                                        <div class="col-md-12" style="margin-bottom:5px">
                                            <app-form-3800b-los [applicationReferenceNumber]="loanSelection?.applicationReferenceNumber"></app-form-3800b-los>
                                            <!-- <iframe [src]="reportSource" id="report" name="report" frameborder="2" height="500px" width="1000px" style="overflow:auto"></iframe> -->
                                            <!-- <div [innerHTML]="form3800bSrc.documentTemplate" id="letter" class="paper" style="overflow:auto;height:400px"></div> -->
                                        </div>
                                        <hr />
                                        <div class="col-md-12">
                                                    <div class="col-md-6 pull-left">
                                                            <button type="button" class="btn btn-primary" style="margin-right: 5px;" (click)="popoverSeeMore()">View Offer Letter</button>
                                                    </div>
                                                <!-- <div class="col-md-6 pull-left">
                                                    <button (click)="print(form3800bSrc.documentTemplate)" class="btn btn-default">
                                                        <i class="glyphicon glyphicon-print"></i> print</button>
                                                </div> -->
                                        </div>
                                    </div>
                                </p-tabPanel >
                                <p-tabPanel i18n-header  header="Loan Information" [disabled]="isLoanInfoDisabled">
                                    <p-accordion #accordion>
                                        <p-accordionTab i18n-header [selected]="true" header="Primary Loan Information">
                                            <div class="panel panel-default">
                                                <div class="panel-heading">
                                                    <div class="row">
                                                        <div class="col-md-12">
                                                            <h2
                                                             class="panel-title pull-left">

                                                            </h2>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="panel-body">
                                                    <div class="form-horizontal">
                                                        <div class="form-group">
                                                            <label i18n for="" class="control-label col-md-2">Application Ref. No.</label>
                                                            <div class="col-md-4 no-data-div">
                                                                <input type="text" formControlName="applicationReferenceNumber" name="applicationReferenceNumber" [ngClass]="!loanBookingForm.controls['applicationReferenceNumber'].valid ? 'required-input' : 'valid-input'"
                                                                    class="form-control" [disabled]="true">
                                                            </div>
                                                            <label i18n for="" class="control-label col-md-2">Loan Type</label>
                                                            <div class="col-md-4 no-data-div">
                                                                <input type="text" formControlName="loanTypeName" name="loanTypeName" [ngClass]="!loanBookingForm.controls['loanTypeName'].valid ? 'required-input' : 'valid-input'"
                                                                    class="form-control">
                                                            </div>
                                                        </div>

                                                        <div class="form-group ">
                                                            <label i18n for="" class="control-label col-md-2">Relationship Officer</label>
                                                            <div class="col-md-4 no-data-div">
                                                                <input type="text" formControlName="relationshipOfficerName" name="relationshipOfficerName" [ngClass]="!loanBookingForm.controls['relationshipOfficerName'].valid ? 'required-input' : 'valid-input'"
                                                                    class="form-control">
                                                            </div>
                                                            <label i18n for="" class="control-label col-md-2">Relationship Manager</label>
                                                            <div class="col-md-4 no-data-div">
                                                                <input type="text" formControlName="relationshipManagerName" name="relationshipManagerName" [ngClass]="!loanBookingForm.controls['relationshipManagerName'].valid ? 'required-input' : 'valid-input'"
                                                                    class="form-control">
                                                            </div>
                                                        </div>

                                                        <div class="form-group">
                                                            <label for="" class="control-label col-md-2"><span i18n>Group Approved Amount </span>({{ loanSelection.currencyCode }})</label>
                                                            <div class="col-md-4 no-data-div">
                                                                <input type="text" formatM formControlName="groupApprovedAmount" [ngClass]="!loanBookingForm.controls['groupApprovedAmount'].valid ? 'required-input' : 'valid-input'"
                                                                    formatM name="groupApprovedAmount" class="form-control">
                                                            </div>
                                                            <label for="" class="control-label col-md-2"><span i18n>Customer Approved Amount </span>({{ loanSelection.currencyCode }})</label>
                                                            <div class="col-md-4 no-data-div">
                                                                <input type="text" formatM formControlName="approvedAmount" name="approvedAmount" [ngClass]="!loanBookingForm.controls['approvedAmount'].valid ? 'required-input' : 'valid-input'"
                                                                    class="form-control">
                                                            </div>
                                                        </div>

                                                        <div class="form-group">
                                                            <label for="" class="control-label col-md-2"><span i18n>Available Amount</span> ({{ loanSelection.currencyCode }})</label>
                                                            <div class="col-md-4 no-data-div">
                                                                <input type="text" formControlName="availableAmount" [ngClass]="!loanBookingForm.controls['availableAmount'].valid ? 'required-input' : 'valid-input'"
                                                                    formatM name="availableAmount" class="form-control">
                                                            </div>
                                                            <label i18n for="" class="control-label col-md-2">Interest Rate</label>
                                                            <div class="col-md-4 no-data-div">
                                                                <input type="text" formControlName="interestRate" name="interestRate" [ngClass]="!loanBookingForm.controls['interestRate'].valid ? 'required-input' : 'valid-input'"
                                                                    class="form-control">
                                                            </div>
                                                        </div>

                                                        <div class="form-group">
                                                            <label for="" class="control-label col-md-2"><span i18n>Disbursement Amount</span> ({{ loanSelection.currencyCode }})</label>
                                                            <div class="col-md-4 no-data-div">
                                                                <input type="text" formatM name="disbursementAmount" (onClick)="onTabChange()" (onfocus)="onTabChange()" (blur)="onTabChange()"
                                                                    formControlName="disbursementAmount" [ngClass]="!loanBookingForm.controls['disbursementAmount'].valid ? 'required-input' : 'valid-input'"
                                                                    class="form-control">
                                                            </div>
                                                            <label i18n for="" class="control-label col-md-2">Facility </label>
                                                            <div class="col-md-4 no-data-div">
                                                                <input type="text" name="productName" formControlName="productName" [ngClass]="!loanBookingForm.controls['productName'].valid ? 'required-input' : 'valid-input'"
                                                                    class="form-control">
                                                            </div>
                                                        </div>
                                                        <div class="form-group">
                                                            <label i18n for="" class="control-label col-md-2">Currency</label>
                                                            <div class="col-md-4 no-data-div">
                                                                <input type="text" name="currencyCode" formControlName="currencyCode" [ngClass]="!loanBookingForm.controls['currencyCode'].valid ? 'required-input' : 'valid-input'"
                                                                    class="form-control">
                                                            </div>
                                                            <label i18n for="" class="control-label col-md-2">Exchange Rate</label>
                                                            <div class="col-md-4 no-data-div">
                                                                <input type="text" name="exchangeRate" formControlName="exchangeRate" [ngClass]="!loanBookingForm.controls['exchangeRate'].valid ? 'required-input' : 'valid-input'"
                                                                    class="form-control">
                                                            </div>
                                                        </div>
                                                        
                                                        <div class="form-group">
                                                            <label i18n for="" class="control-label col-md-2">Approved Line Effective Date</label>
                                                            <div class="col-md-4 no-data-div">
                                                                <input type="text" name="tenor" formControlName="approvedEffectiveDate" [ngClass]="!loanBookingForm.controls['approvedEffectiveDate'].valid ? 'required-input' : 'valid-input'"
                                                                    class="form-control">
                                                            </div>

                                                            <label i18n for="" class="control-label col-md-2">Account to debit </label>
                                                            <div class="col-md-4 no-data-div">
                                                                <input type="text" name="accountToCredit" formControlName="accountToCredit" [ngClass]="!loanBookingForm.controls['accountToCredit'].valid ? 'required-input' : 'valid-input'"
                                                                    class="form-control">
                                                            </div>
                                                        </div>
                                                        <div class="form-group">
                                                            <label i18n for="" class="control-label col-md-2">Approved Tenor (in days)</label>
                                                            <div class="col-md-4 no-data-div">
                                                                <input type="text" name="tenor" formControlName="tenor" [ngClass]="!loanBookingForm.controls['tenor'].valid ? 'required-input' : 'valid-input'"
                                                                    class="form-control">
                                                            </div>
                                                            <label i18n *ngIf="!isCommercialLoan" for="" class="control-label col-md-2">Approved Tenor (in months)</label>
                                                            <div *ngIf="!isCommercialLoan" class="col-md-4 no-data-div">
                                                                <input type="text" name="tenorInMonths" formControlName="tenorInMonths" [ngClass]="!loanBookingForm.controls['tenorInMonths'].valid ? 'required-input' : 'valid-input'"
                                                                    class="form-control">
                                                            </div>
                                                        </div>
                                                        <div class="form-group">
                                                            <!-- <label i18n for="" class="control-label col-md-2">Approved Tenor (in days)</label>
                                                            <div class="col-md-4 no-data-div">
                                                                <input type="text" name="tenor" formControlName="tenor" [ngClass]="!loanBookingForm.controls['tenor'].valid ? 'required-input' : 'valid-input'"
                                                                    class="form-control">
                                                            </div> -->
                                                            <!-- <label i18n for="" class="control-label col-md-2">Loan Information</label>
                                                            <div class="col-md-4 no-data-div">
                                                                <textarea type="text" name="loanInformation" formControlName="loanInformation" [ngClass]="!loanBookingForm.controls['loanInformation'].valid ? 'required-input' : 'valid-input'"
                                                                    class="form-control">
                                                                    </textarea>
                                                            </div> -->
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </p-accordionTab>
                                        <p-accordionTab i18n-header header="Loan Covenant Information">
                                                <div class="panel panel-default">
                                                        <div class="panel-heading">
                                                            <div class="row">
                                                                <div class="col-md-12">
                                                                    <h2 i18n class="panel-title pull-left">
                                                                        Loan Covenant
                                                                    </h2>
                                                                    <!-- <div class="pull-right">
                                                                        <button (click)="showCovenantDetailForm()" pButton type="button" label="Add New Covenant" icon="fa-plus"></button>
                                                                    </div> -->
                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="panel-body">
                                                            <p-dataTable  [value]="covenantDetails" [responsive]="true" [paginator]="true" [rows]="5">
                                                                <p-column i18n-header field="covenantTypeName" header="Covenant Type" sortable="true" filterMatchMode="contains"></p-column>
                                                                <p-column i18n-header field="covenantDetail" header="Covenant Detail" sortable="true" filterMatchMode="contains"></p-column>
                                                                <p-column i18n-header field="frequencyTypeName" header="Frequency Type" sortable="true" filterMatchMode="contains"></p-column>
                                                                <p-column i18n-header field="covenantAmount" header="Amount" sortable="true" filterMatchMode="contains"></p-column>
                                                                <p-column i18n-header field="covenantDate" header="Date" sortable="true" filterMatchMode="contains">
                                                                    <ng-template let-col let-cov="rowData" pTemplate="body">
                                                                        {{cov[col.field] | date : 'dd/MM/yyyy' }}
                                                                    </ng-template>
                                                                </p-column>
                                                            </p-dataTable>
                                                        </div>
                                                    </div>
                                        </p-accordionTab>
                                        <p-accordionTab i18n-header header="Loan Collateral(s)">
                                            <p-dataTable id="loanCollateralList" [value]="loanSelection.loanCollateral" [responsive]="true" [paginator]="true" [rows]="5">
                                                <p-column *ngIf="isGroup" field="customerName" header="Customer Name" sortable="true" filterMatchMode="contains"></p-column>
                                                <p-column i18n-header field="collateralTypeName" header="Type" [style]="{'width':'280px'}" sortable="true" filterMatchMode="contains"></p-column>
                                                <p-column i18n-header field="currencyCode" header="" [style]="{'text-align':'right','width':'40px'}" sortable="true" filterMatchMode="contains"></p-column>
                                                <p-column i18n-header field="collateralValue" header="Value" sortable="true" filterMatchMode="contains">
                                                    <ng-template pTemplate="body" let-item="rowData">
                                                        {{item.collateralValue | number:'1.2'}}
                                                    </ng-template>
                                                </p-column>
                                                <p-column i18n-header field="haircut" header="Haircut" sortable="true" filterMatchMode="contains"></p-column>
                                                <p-column i18n-header field="valuationCycle" header="Valuation Cycle" sortable="true" filterMatchMode="contains"></p-column>
                                                <p-column i18n-header [style]="{'width':'60px'}" field="allowSharing" header="share Allowed" sortable="true" filterMatchMode="contains">
                                                    <ng-template pTemplate="header" i18n>Can Share?</ng-template>
                                                    <ng-template let-d="rowData" let-i="rowIndex" pTemplate="body">
                                                        <span i18n *ngIf="d.allowSharing">Yes</span>
                                                        <span i18n *ngIf="!d.allowSharing">No</span>
                                                    </ng-template>
                                                </p-column>
                                                <p-column [style]="{'width':'40px'}">
                                                    <ng-template pTemplate="header"></ng-template>
                                                    <ng-template let-d="rowData" let-i="rowIndex" pTemplate="body">
                                                        <a i18n (click)="ViewCollateralDetails(d)" href="javascript:void(0)">View</a>
                                                    </ng-template>
                                                </p-column>
                                            </p-dataTable>
                                            <!-- <div *ngIf="displayCollateralDetails" class="panel-body" style="overflow:auto;height:250px">
                                                <collateral-information-view [showCollateralInformation]=true [isHeaderInfoBased]=false [collateralCustomerId]=collateralCustomerId [useSearch]=false [collateralTypeId]=collateralTypeId [repeatbleSearch]=false>
                                                </collateral-information-view>
                                            </div> -->
                                        </p-accordionTab>
                                        <p-accordionTab i18n-header header="Loan Documents">
                                            <div class="panel panel-default">
                                                <div class="panel-heading">
                                                    <h2 i18n class="panel-title">
                                                        Supporting Documents
                                                    </h2>
                                                </div>
                                                <div class="panel-body">
                                                    <document-upload 
                                                        [deleteLink]="false"
                                                        [panelTitle]="CREDITAPPRIASALDOC"
                                                        [reload]="loanSelection?.loanApplicationId" 
                                                        [operationId]="loanSelection?.operationId" 
                                                        [customerId]="loanSelection?.customerId"
                                                        [isOperationSpecific]="false"
                                                        [targetId]="loanSelection?.loanApplicationId" 
                                                        [targetReferenceNumber]="loanSelection?.applicationReferenceNumber">
                                                    </document-upload> 
                                               </div>
                                            </div>
                                        </p-accordionTab>
                                        <p-accordionTab i18n-header header="Loan Job Requests">
                                            <div *ngIf="loanSelection != null" class="panel-body" style="overflow:auto;height:250px">
                                                <job-request-view 
                                                    [loanApplicationId]=loanSelection.loanApplicationId 
                                                    [loanApplicationDetailId]=loanSelection.loanId
                                                    [operationId]=loanSelection.operationId
                                                    [showTitle]=false>
                                                </job-request-view>
                                            </div>
                                        </p-accordionTab>
                                    </p-accordion>
                                </p-tabPanel >

                                <p-tabPanel i18n-header  header="Checklist" [disabled]="isLoanInfoDisabled">
                                    <div class="panel panel-default">
                                        <div class="panel-heading">
                                            <h2 i18n class="panel-title">Loan Application Checklist</h2>
                                        </div>
                                        <div class="panel-body">
                                            <app-loan-checklist [operationId]="loanSelection.operationId" [productClassProcessId]="loanSelection.productClassProcessId" [productId]="loanSelection.productId"
                                                [loanApplicationDetailId]="loanSelection.loanApplicationId" [loanApplicationId]="loanSelection.loanApplicationId" [isAvailmentChecklist]="true"
                                                [isAvailmentChecklist]="false" [onPageLoad]="false" [isViewOnly]="true">
                                            </app-loan-checklist>
                                        </div>
                                    </div>
                                </p-tabPanel >

                                <p-tabPanel i18n-header  header="Monitoring Trigger" [disabled]="isLoanInfoDisabled">
                                    <div class="card no-padding">
                                        <div class="panel panel-default">
                                            <div class="panel-heading">
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <h2 i18n class="panel-title pull-left">
                                                            Loan Monitoring Trigger
                                                        </h2>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="panel-body">
                                                <p-dataTable [value]="loanSelection.loanMonitoringTrigger" [responsive]="true" [paginator]="false"
                                                    [rows]="10">
                                                    <p-column i18n-header field="monitoringTrigger" header="Trigger" sortable="true" filterMatchMode="contains"></p-column>
                                                </p-dataTable>
                                            </div>
                                        </div>
                                        <!--end of panel-->
                                    </div>
                                </p-tabPanel >

                                <p-tabPanel i18n-header  header="Transaction Dynamics" [disabled]="isLoanInfoDisabled">
                                    <div class="card no-padding">
                                        <div class="panel panel-default">
                                            <div class="panel-heading">
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <h2 i18n class="panel-title pull-left">
                                                            Loan Transaction Dynamics
                                                        </h2>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="panel-body">
                                                <p-dataTable  [value]="loanSelection.loanTransationDynamics" [responsive]="true" [paginator]="false"
                                                    [rows]="10">
                                                    <p-column i18n-header field="dynamics" header="Transaction Dynamics" sortable="true" filterMatchMode="contains"></p-column>
                                                </p-dataTable>
                                            </div>
                                        </div>
                                        <!--end of panel-->
                                    </div>
                                </p-tabPanel >
                                <p-tabPanel i18n-header  header="Approval Comments" [disabled]="isLoanInfoDisabled">
                                    <app-approval-comments [all]="true" [tableLabel]="'Approval Process Comments'" [operationId]="loanSelection?.operationId" [applicationId]="loanSelection?.loanApplicationId"></app-approval-comments>
                                                           
                                       
                                    </p-tabPanel >
                                    <p-tabPanel i18n-header  [disabled]="isLoanInfoDisabled" header="Drawdown Memo">
                                        <div class="panel panel-default">
                                            <div class="panel-heading">
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <h2 i18n class="panel-title pull-left">
                                                            Drawdown Memo
                                                        </h2>
                                                        <button i18n  (click)="printMemo()" style="margin-left:25px" >Generate Drawdown Memo</button>
                                                               
                                                         <!-- <button type="button" (click)="displayReport=false" style="margin-right:5px" class="btn btn-danger pull-right">Cancel</button> -->
                                                    </div>
                                                </div>
                                            </div>
                                            <!-- <div *ngIf="drawdownHtml != null" class="panel-body" style="min-height:450px;">
                                                <CKEDITOR [content]="drawdownHtml" [height]="400"
                                                    (contentChange)="contentChange($event)"></CKEDITOR>
                                            </div> -->
                                            <div id="print-section" class="panel-body" [innerHtml]="drawdownHtml">
                                            </div>
                                        </div>
                                </p-tabPanel >
                                <p-tabPanel i18n-header  header="Charge Fees" [disabled]="isChargesDisabled">
                                    <div class="card no-padding">

                                        <div class="panel panel-default">
                                            <div class="panel-heading">
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <h2 i18n class="panel-title pull-left">
                                                            Loan Charge/Fee
                                                        </h2>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="panel-body">
                                                <p-dataTable *ngIf="displayLoanCharges1" [value]="loanProductFees " [responsive]="true" [paginator]="false" [rows]="5">
                                                    <p-column i18n-header field="feeName" header="Fee Name" sortable="true" filterMatchMode="contains"></p-column>
                                                    <p-column i18n-header field="valueBase" [style]="{'width':'60px'}" header="" sortable="true" filterMatchMode="contains">         
                                                    </p-column>
                                                    <p-column i18n-header field="recommededFeeRateValue" header="Value" sortable="true" filterMatchMode="contains"></p-column>
                                                    <p-column i18n-header field="feeAmount" header="Fee Amount" sortable="true" filterMatchMode="contains">
                                                        <ng-template pTemplate="body" let-item="rowData">
                                                            {{item.feeAmount | number:'1.2'}}
                                                        </ng-template>
                                                    </p-column>
                                                    <p-column i18n-header field="isIntegralFee" header="Integral?" sortable="true" filterMatchMode="contains"></p-column>
                                                    <p-column i18n-header field="hasConsession" header="Concession?" sortable="true" filterMatchMode="contains">
                                                            <ng-template pTemplate="header" i18n> Concession? </ng-template>
                                                            <ng-template let-d="rowData" let-i="rowIndex" pTemplate="body">
                                                                <span i18n *ngIf="d.hasConsession == false"> No</span>
                                                                <span i18n *ngIf="d.hasConsession == true"> Yes</span>
                                                            </ng-template>
                                                        </p-column>

                                                </p-dataTable>
                                                <p-dataTable *ngIf="displayLoanCharges2" [value]="loanProductFees " [responsive]="true" [paginator]="false" [rows]="5">
                                                    <p-column i18n-header field="feeName" header="Fee Name" sortable="true" filterMatchMode="contains"></p-column>
                                                    <p-column i18n-header field="valueBase" [style]="{'width':'60px'}" header="" sortable="true" filterMatchMode="contains">         
                                                    </p-column>
                                                    <p-column i18n-header field="recommededFeeRateValue" header="Value" sortable="true" filterMatchMode="contains"></p-column>
                                                    <p-column i18n-header field="feeAmount" header="Fee Amount" sortable="true" filterMatchMode="contains">
                                                        <ng-template pTemplate="body" let-item="rowData">
                                                            {{item.feeAmount | number:'1.2'}}
                                                        </ng-template>
                                                    </p-column>
                                                    <p-column i18n-header field="isIntegralFee" header="Integral?" sortable="true" filterMatchMode="contains">
                                                        <ng-template let-user="rowData" let-i="rowIndex" pTemplate="body">
                                                            <span i18n *ngIf="false"> No</span>
                                                            <span i18n *ngIf="true"> Yes</span>
                                                        </ng-template>
                                                    </p-column>
                                                    <p-column i18n-header field="hasConsession" header="Concession?" sortable="true" filterMatchMode="contains">
                                                        <ng-template pTemplate="header"> Concession? </ng-template>
                                                        <ng-template let-d="rowData" let-i="rowIndex" pTemplate="body">
                                                            <span i18n *ngIf="d.hasConsession == false"> No</span>
                                                            <span i18n *ngIf="d.hasConsession == true"> Yes</span>
                                                        </ng-template>
                                                    </p-column>
                                                    
                                                </p-dataTable>
                                            </div>
                                            <table class="table table-customer-information">
                                                <tbody>
                                                    <tr>
                                                        <td></td>
                                                        <td>
                                                            <button type="button" (click)="getAccountBalance()" class="btn btn-default btn-sm pull-left">
                                                                <span class="glyphicon glyphicon-refresh"></span>
                                                                <ng-container i18n>Get Account Balance</ng-container>
                                                            </button> &nbsp; &nbsp;&nbsp;&nbsp;
                                                            <strong>{{ selectedAccountBalance | currency:loanSelection.currencyCode:true:
                                                                '1.2-2' }}</strong>
                                                        </td>
                                                        <td></td>
                                                        <td>
                                                            <strong>Total Fee Amount: {{ feeAmountTotal | currency:loanSelection.currencyCode:true:'1.2-2'}}</strong>
                                                        </td>
                                                    </tr>
                                                    <tr *ngIf="loanSelection != null && !loanSelection.isLocalCurrrency && !isIDF && loanSelection.feeAccountName != null">
                                                        <td></td>
                                                        <td>
                                                            Fee will be deducted from account : <strong>{{loanSelection.feeAccountName}}</strong>
                                                        </td>
                                                        <td></td>
                                                        <td>
                                                           
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                            <div *ngIf="override != null && override != undefined " class="panel-body">
                                                <p-accordion #accordion>
                                                    <p-accordionTab i18n-header header="Fee Concession">
                                                        <p-dataTable  [value]="override" [responsive]="true" [paginator]="true" [rows]="5">
                                                            <p-column i18n-header field="consessionReason" header="Consession Reason" sortable="true" filterMatchMode="contains"></p-column>
                                                            <p-column i18n-header field="recommededFeeRateValue" header="Recommeded Rate"  sortable="true" filterMatchMode="contains"></p-column>
                                                            <!-- <p-column i18n-header field="status" header="Status" sortable="true" filterMatchMode="contains"></p-column> -->
                                                        </p-dataTable>
                                                    </p-accordionTab>
                                                </p-accordion>
                                            </div>
                                        </div>
                                        <!--end of panel-->
                                    </div>
                                </p-tabPanel >
                                
                                <!-- <p-tabPanel i18n-header  *ngIf="loanSelection.isUnderApproval " header="{{scheduleTitle}}" [disabled]="isScheduleDisabled"> -->
                                <p-tabPanel  header="{{scheduleTitle}}" [disabled]="isScheduleDisabled">
                                    <div class="panel panel-default">
                                        <div class="panel-heading">
                                            <div class="row">
                                                <div class="col-md-12">
                                                    <h2 class="panel-title pull-left">
                                                        {{scheduleTitle}}
                                                    </h2>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="panel-body">
                                            <div *ngIf="!isScheduledLoan" class="panel-body">
                                                <div *ngIf="isRevolvingLoan" class="form-horizontal">
                                                    <div class="form-group">
                                                        <label i18n for="" class="control-label col-md-2">
                                                            Interest Rate
                                                        </label>
                                                        <div class="col-md-4 no-data-div">
                                                            <input type="text" [hidden]="isScheduledLoan" (blur)="validateLoanInputs()" formControlName="revolvingInterestRate" name="revolvingInterestRate"
                                                                [ngClass]="!loanBookingForm.controls['revolvingInterestRate'].valid ? 'required-input' : 'valid-input'"
                                                                class="form-control">
                                                        </div>
                                                        <label i18n for="" class="control-label col-md-2">
                                                            Effective Date
                                                        </label>
                                                        <div class="col-md-4">
                                                            <p-calendar id="revolvingEffectiveDate" formControlName="revolvingEffectiveDate" dateFormat="dd/mm/yy" [hidden]="isScheduledLoan"
                                                                [responsive]="true" (onSelect)="calculateMaturityDate()" [ngClass]="!loanBookingForm.controls['revolvingEffectiveDate'].valid ? 'required-input' : 'valid-input'"
                                                                [inputStyle]="{'width': '100%' }" [style]="{'width': '100%', 'overflow': 'visible'  }"
                                                                [monthNavigator]="true" [yearNavigator]="true" yearRange="1955:2030"
                                                                [showIcon]="true"></p-calendar>
                                                        </div>
                                                    </div>

                                                    <div class="form-group ">
                                                        <label i18n for="" class="control-label col-md-2">
                                                            Maturity Date</label>
                                                        <div class="col-md-4 no-data-div">
                                                            <p-calendar [hidden]="isScheduledLoan" id="revolvingMaturityDate" formControlName="revolvingMaturityDate" dateFormat="dd/mm/yy"
                                                                [ngClass]="!loanBookingForm.controls['revolvingMaturityDate'].valid ? 'required-input' : 'valid-input'"
                                                                [responsive]="true" [inputStyle]="{'width': '100%' }" [style]="{'width': '100%', 'overflow': 'visible'  }"
                                                                [monthNavigator]="true" [yearNavigator]="true" yearRange="1955:2030"
                                                                [showIcon]="true"></p-calendar>
                                                        </div>
                                                        <label i18n for="" class="control-label col-md-2">
                                                            Overdraft Limit
                                                        </label>
                                                        <div class="col-md-4 ">
                                                            <input type="text" [attr.disabled]="true" (blur)="validateLoanInputs()" [hidden]="isScheduledLoan" formControlName="revolvingOverdraftLimit"
                                                                name="revolvingOverdraftLimit" [ngClass]="!loanBookingForm.controls['revolvingOverdraftLimit'].valid ? 'required-input' : 'valid-input'"
                                                                class="form-control">
                                                        </div>
                                                    </div>

                                                    <div class="form-group">
                                                        <label i18n for="basis" class="control-label col-md-2">Basis</label>
                                                        <div class="col-md-4">
                                                            <select name="accrualBasis" id="accrualBasis" formControlName="accrualBasis" [hidden]="isScheduledLoan" (onchange)="validateLoanInputs()"
                                                                class="form-control" [ngClass]="!loanBookingForm.controls['accrualBasis'].valid ? 'required-input' : 'valid-input'">
                                                                <option value=""></option>
                                                                <option *ngFor="let b of basis" value="{{b.lookupId}}">
                                                                    {{b.lookupName}}
                                                                </option>
                                                            </select>
                                                        </div>
                                                        <label i18n *ngIf="loanSelection.isTemporaryOverdraft" for="revolvingTypeId" class="control-label col-md-2">Revolving Type</label>
                                                        <div *ngIf="loanSelection.isTemporaryOverdraft" class="col-md-4">
                                                            <select class="col-md-8" name="revolvingTypeId" id="revolvingTypeId" (change)="assignRevolvingTypeId()" formControlName="revolvingTypeId"
                                                                class="form-control" [ngClass]="!loanBookingForm.controls['revolvingTypeId'].valid ? 'required-input' : 'valid-input'">
                                                                <option i18n value="">Select Revolving Type</option>
                                                                <option *ngFor="let b of revolvingTypes" value="{{b.revolvingTypeId}}">
                                                                    {{b.revolvingTypeName}}
                                                                </option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <!-- <div class="form-group">
                                                        <label i18n for="Comment" class="control-label col-md-2">Comment</label>
                                                        <div class="col-md-4">
                                                            <textarea formControlName="comment" [ngClass]="!loanBookingForm.controls['comment'].valid ? 'required-input' : 'valid-input'"
                                                            class="form-control" name="comment"
                                                            cols="15" ></textarea>
                                                        </div>
                                                    </div> -->
                                                    
                                                </div>

                                                <div *ngIf="isCommercialLoan" class="form-horizontal">
                                                    <div class="form-group">
                                                        <label i18n for="" class="control-label col-md-2">Principal Amount</label>
                                                        <div class="col-md-4 ">
                                                            <input type="text" [attr.disabled]="true" (blur)="validateLoanInputs()" [hidden]="isScheduledLoan" formControlName="commercialPrincipal"
                                                                name="commercialPrincipal" [ngClass]="!loanBookingForm.controls['commercialPrincipal'].valid ? 'required-input' : 'valid-input'"
                                                                class="form-control">
                                                        </div>
                                                        <label i18n for="" class="control-label col-md-2">
                                                            Interest Rate
                                                        </label>
                                                        <div class="col-md-4 no-data-div">
                                                            <input type="text" [attr.disabled]="true" [hidden]="isScheduledLoan" (blur)="validateLoanInputs()" formControlName="commercialInterestRate"
                                                                name="v" [ngClass]="!loanBookingForm.controls['commercialInterestRate'].valid ? 'required-input' : 'valid-input'"
                                                                class="form-control">
                                                        </div>
                                                    </div>

                                                    <div class="form-group ">
                                                        <label i18n for="" class="control-label col-md-2">Effective Date</label>
                                                        <div class="col-md-4">
                                                            <p-calendar [attr.disabled]="true" (onSelect)="calculateMaturityDate()" id="commercialEffectiveDate" formControlName="commercialEffectiveDate" dateFormat="dd/mm/yy"
                                                                [hidden]="isScheduledLoan" [responsive]="true" [ngClass]="!loanBookingForm.controls['commercialEffectiveDate'].valid ? 'required-input' : 'valid-input'"
                                                                [inputStyle]="{'width': '100%' }" [style]="{'width': '100%', 'overflow': 'visible'  }"
                                                                [monthNavigator]="true" [yearNavigator]="true" yearRange="1955:2030"
                                                                [showIcon]="true"></p-calendar>
                                                        </div>
                                                        <label i18n for="" class="control-label col-md-2">Maturity Date</label>
                                                        <div class="col-md-4">
                                                            <p-calendar [attr.disabled]="true" [hidden]="isScheduledLoan" id="commercialMaturityDate" formControlName="commercialMaturityDate"
                                                                dateFormat="dd/mm/yy" [ngClass]="!loanBookingForm.controls['commercialMaturityDate'].valid ? 'required-input' : 'valid-input'"
                                                                [responsive]="true" [inputStyle]="{'width': '100%' }" [style]="{'width': '100%', 'overflow': 'visible'  }"
                                                                [monthNavigator]="true" [yearNavigator]="true" yearRange="1955:2030"
                                                                [showIcon]="true"></p-calendar>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label i18n for="" class="control-label col-md-2">Interest Type</label>
                                                        <div class="col-md-4">
                                                            <select name="commercialInterestProductId" id="commercialInterestProductId" (change)="reMapProduct($event)" formControlName="commercialInterestProductId"
                                                                class="form-control" [ngClass]="!loanBookingForm.controls['commercialInterestProductId'].valid ? 'required-input' : 'valid-input'">
                                                                <option i18n value="">Select Interest Type</option>
                                                                <option *ngFor="let b of commercialLoans" value="{{b.productId}}">
                                                                    {{b.productName}}
                                                                </option>
                                                            </select>
                                                        </div>
                                                        <label i18n for="basis" class="control-label col-md-2">Basis</label>
                                                        <div class="col-md-4">
                                                            <select name="accrualBasis" (onchange)="validateLoanInputs()" class="form-control" >
                                                                <!-- <option value=""></option> -->
                                                                <option *ngFor="let b of basisCommercial" value="{{b.lookupId}}">
                                                                    {{b.lookupName}}
                                                                </option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label i18n for="" class="control-label col-md-2">Price Index</label>
                                                        <div class="col-md-4">
                                                            <select (change)="onProductPriceIndexChange($event.target)" name="priceIndexId"  id="priceIndexId" formControlName="priceIndexId" class="form-control" >
                                                                <option i18n value="">Select Price Index</option>
                                                                <option *ngFor="let b of productCurrencyPriceIndex" value="{{b.productPriceIndexId}}">
                                                                    {{b.priceIndexName}}
                                                                </option>
                                                            </select>
                                                        </div>
                                                        <label i18n for="" class="control-label col-md-2">Tenor</label>
                                                        <div class="col-md-4">
                                                            <input type="text" [hidden]="isScheduledLoan" (blur)="validateTenor($event.target.value)" (keyup)="validateTenor($event.target.value)" formControlName="commercialTenor"
                                                                name="v" [ngClass]="!loanBookingForm.controls['commercialTenor'].valid ? 'required-input' : 'valid-input'"
                                                                class="form-control">
                                                        </div>
                                                        
                                                    </div>
                                                    <div *ngIf="loanBookingForm.value.commercialInterestProductId != undefined" class="form-group">
                                                        <label i18n *ngIf="!isDicounted" for="" class="control-label col-md-2">Interest Amount</label>
                                                        <div *ngIf="!isDicounted" class="col-md-4">
                                                            <label for="" class="control-label">{{interestRateAmount | number:'1.2'}}</label>
                                                        </div>

                                                        <div *ngIf="isDicounted">
                                                            <label i18n *ngIf="isDicounted" for="" class="control-label col-md-2">Discount</label>
                                                            <div *ngIf="isDicounted" class="col-md-4">
                                                                <label for="" class="control-label">{{interestRateAmount | number:'1.2'}}</label>
                                                            </div>
        
                                                            <label i18n *ngIf="isDicounted" for="" class="control-label col-md-2">Discounted Value</label>
                                                            <div *ngIf="isDicounted" class="col-md-4">
                                                                <label for="" class="control-label">{{(loanAmount - interestRateAmount) | number:'1.2'}} </label>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label i18n for="Comment" class="control-label col-md-2">Comment</label>
                                                        <div class="col-md-4">
                                                            <textarea formControlName="comment" [ngClass]="!loanBookingForm.controls['comment'].valid ? 'required-input' : 'valid-input'"
                                                            class="form-control" name="comment"
                                                            cols="15" ></textarea>
                                                        </div>
                                                    </div>
                                                    
                                                </div>
                                                <div *ngIf="isForeignExchangeLoan" class="form-horizontal">
                                                    <div class="form-group">
                                                        <label i18n for="" class="control-label col-md-2">Principal Amount</label>
                                                        <div class="col-md-4 ">
                                                            <input type="text" [attr.disabled]="true" (blur)="validateLoanInputs()" [hidden]="isScheduledLoan" formControlName="fxPrincipal"
                                                                name="fxPrincipal" [ngClass]="!loanBookingForm.controls['fxPrincipal'].valid ? 'required-input' : 'valid-input'"
                                                                class="form-control">
                                                        </div>
                                                        <label i18n for="" class="control-label col-md-2">
                                                            Interest Rate
                                                        </label>
                                                        <div class="col-md-4 no-data-div">
                                                            <input type="text" [attr.disabled]="true" [hidden]="isScheduledLoan" (blur)="validateLoanInputs()" formControlName="fxInterestRate"
                                                                name="v" [ngClass]="!loanBookingForm.controls['fxInterestRate'].valid ? 'required-input' : 'valid-input'"
                                                                class="form-control">
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label i18n for="" class="control-label col-md-2">Effective Date</label>
                                                        <div class="col-md-4">
                                                            <p-calendar id="fxEffectiveDate" (onSelect)="calculateMaturityDate()" formControlName="fxEffectiveDate" dateFormat="dd/mm/yy" [hidden]="isScheduledLoan"
                                                                [responsive]="true" [ngClass]="!loanBookingForm.controls['fxEffectiveDate'].valid ? 'required-input' : 'valid-input'"
                                                                [inputStyle]="{'width': '100%' }" [style]="{'width': '100%', 'overflow': 'visible'  }"
                                                                [monthNavigator]="true" [yearNavigator]="true" yearRange="1955:2030"
                                                                [showIcon]="true"></p-calendar>
                                                        </div>
                                                        <label i18n for="" class="control-label col-md-2">Maturity Date</label>
                                                        <div class="col-md-4">
                                                            <p-calendar [attr.disabled]="true" [hidden]="isScheduledLoan" id="fxMaturityDate" formControlName="fxMaturityDate" dateFormat="dd/mm/yy"
                                                                [ngClass]="!loanBookingForm.controls['fxMaturityDate'].valid ? 'required-input' : 'valid-input'"
                                                                [responsive]="true" [inputStyle]="{'width': '100%' }" [style]="{'width': '100%', 'overflow': 'visible'  }"
                                                                [monthNavigator]="true" [yearNavigator]="true" yearRange="1955:2030"
                                                                [showIcon]="true"></p-calendar>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label i18n for="" class="control-label col-md-2">Loan Tenor</label>
                                                        <div class="col-md-4 ">
                                                            <input type="text" (blur)="validateTenor($event.target.value)" (keyup)="validateTenor($event.target.value)" formControlName="fxTenor" (blur)="calculateMaturityDate()"
                                                                name="fxTenor" [ngClass]="!loanBookingForm.controls['fxTenor'].valid ? 'required-input' : 'valid-input'"
                                                                class="form-control">
                                                        </div>
                                                        <label i18n for="" class="control-label col-md-2">Price Index</label>
                                                        <div class="col-md-4">
                                                            <select (change)="onProductPriceIndexChange($event.target)" name="priceIndexId"  id="priceIndexId" formControlName="priceIndexId" class="form-control" >
                                                                <option i18n value="">Select Price Index</option>
                                                                <option *ngFor="let b of productCurrencyPriceIndex" value="{{b.productPriceIndexId}}">
                                                                    {{b.priceIndexName}}
                                                                </option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label i18n for="" class="control-label col-md-2"></label>
                                                        <div class="col-md-4">
                                                                <button pButton type="button"  style="margin: 5px" (click)="displayBeneficiaryForm=true" i18n-label label=" Add Beneficiary" class="ui-button-info"></button>
                                                        </div>
                                                        <!-- <label i18n for="Comment" class="control-label col-md-2">Comment</label>
                                                        <div class="col-md-4">
                                                            <textarea formControlName="comment" [ngClass]="!loanBookingForm.controls['comment'].valid ? 'required-input' : 'valid-input'"
                                                            class="form-control" name="comment"
                                                            cols="15" ></textarea>
                                                        </div> -->
                                                    </div>

                                                    <fieldset>
                                                        <legend style="color:#ff0000"><span i18n>Beneficiaries' Plan</span> <span style="font-weight:bold; font-size: large">{{destinationCurrencyAmount | currency:destinationCurrencyCode:true:'1.2-2'}}</span></legend> 
                                                        <div class="form-group">
                                                            <div class="col-md-12">
                                                                <table class="table table-striped">
                                                                    <thead>
                                                                        <tr>
                                                                            <th i18n>S/No</th>
                                                                            <th i18n>Amount</th>
                                                                            <th i18n style="width:150px">Reason</th>
                                                                            <th></th>
                                                                            <!-- <th></th> -->
                                                                        </tr>
                                                                    </thead>
                                                                    <tfoot *ngIf='totalAddedBeneficiaryAmount > 0'>
                                                                        <tr style="padding: 3px;  background-color:#072d64; color: #fff; font: bold;">
                                                                            <td i18n>Total</td>
                                                                            <td>{{totalAddedBeneficiaryAmount | currency:destinationCurrencyCode:true:'1.2-2'}}</td>
                                                                            <td></td>
                                                                            <td></td>
                                                                        </tr>
                                                                    </tfoot>
                                                                    <tbody>
                                                                        <tr *ngFor="let p of beneficiaryList; let indx=index">
                                                                            <td> {{indx + 1}}</td>
                                                                            <td>{{p.beneficiaryAmount | currency:destinationCurrencyCode:true:'1.2-2'}}</td>
                                                                            <td style="width:150px">{{p.beneficiaryReason}}</td>
                                                                            <td style="padding: 0;width:50px">
                                                                                <a (click)="removeBenficiaryItem($event,indx)" style="color:#ff0000" href="#">
                                                                                    <i class="fa fa-times" aria-hidden="true"></i><span>X</span></a>
                                                                            </td>
                                                                        </tr>
                                                                    </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </fieldset>
                                                </div>
                                                <div *ngIf="isContingentLoan" class="form-horizontal">
                                                    <div class="form-group">
                                                        <label i18n for="" class="control-label col-md-2">
                                                            Contingent Amount
                                                        </label>
                                                        <div class="col-md-4 ">
                                                            <input type="text" [attr.disabled]="true" (blur)="validateLoanInputs()" [hidden]="isScheduledLoan" formControlName="contigentAmount"
                                                                name="contigentAmount" [ngClass]="!loanBookingForm.controls['contigentAmount'].valid ? 'required-input' : 'valid-input'"
                                                                class="form-control">
                                                        </div>
                                                        <label i18n for="" class="control-label col-md-2">
                                                            Effective Date
                                                        </label>
                                                        <div class="col-md-4">
                                                            <p-calendar [hidden]="isScheduledLoan" (onSelect)="calculateMaturityDate()" id="contigentEffectiveDate" formControlName="contigentEffectiveDate"
                                                                dateFormat="dd/mm/yy" [ngClass]="!loanBookingForm.controls['contigentEffectiveDate'].valid ? 'required-input' : 'valid-input'"
                                                                [responsive]="true" [inputStyle]="{'width': '100%' }" [style]="{'width': '100%', 'overflow': 'visible'  }"
                                                                [monthNavigator]="true" [yearNavigator]="true" yearRange="1955:2030"
                                                                [showIcon]="true"></p-calendar>

                                                        </div>
                                                    </div>

                                                    <div class="form-group ">
                                                        <label i18n for="" class="control-label col-md-2">
                                                            Maturity Date
                                                        </label>
                                                        <div class="col-md-4 no-data-div">
                                                            <p-calendar [hidden]="isScheduledLoan" (blur)="validateLoanInputs()" id="contingentMaturityDate" formControlName="contingentMaturityDate"
                                                                dateFormat="dd/mm/yy" [ngClass]="!loanBookingForm.controls['contingentMaturityDate'].valid ? 'required-input' : 'valid-input'"
                                                                [responsive]="true" [inputStyle]="{'width': '100%' }" [style]="{'width': '100%', 'overflow': 'visible'  }"
                                                                [monthNavigator]="true" [yearNavigator]="true" yearRange="1955:2030"
                                                                [showIcon]="true"></p-calendar>
                                                        </div>
                                                    </div>
                                                    <!-- <div class="form-group">
                                                        <label i18n for="Comment" class="control-label col-md-2">Comment</label>
                                                        <div class="col-md-4">
                                                            <textarea formControlName="comment" [ngClass]="!loanBookingForm.controls['comment'].valid ? 'required-input' : 'valid-input'"
                                                            class="form-control" name="comment"
                                                            cols="15" ></textarea>
                                                        </div>
                                                        
                                                    </div> -->
                                                </div>
                                            </div>
                                            <div *ngIf="isScheduledLoan">
                                                <schedule-template 
                                                [viewStatus]=true [loanAmount]=loanAmount 
                                                [loanDate]=loanSelection.newApplicationDate 
                                                [interestRate]=loanSelection.interestRate
                                                [tenor]=loanSelection.approvedTenor 
                                                [tenorInMonths]=loanSelection.approvedTenorString 
                                                [scheduleTitle]='scheduleTitle' 
                                                [integralFeeAmount]=integralFeeAmount
                                                [callendarPixelInput]=290 
                                                [productTypeId]=loanSelection.productTypeId 
                                                [isSimulation]=false 
                                                [loanApplicationDetailId]=loanApplicationDetailId 
                                                [currencyId]=loanSelection.currencyId
                                                [repaymentSchedule]=loanSelection.repaymentSchedule 
                                                [scheduleTypeId]=loanSelection.productScheduleTypeId 
                                                [dayCountConventionId]=loanSelection.productDayCountConventionId
                                                [repaymentTerms]=loanSelection.repaymentTerms 
                                                [productPriceIndexId]=loanSelection.productPriceIndexId
                                                [approvedInterestRate]=loanSelection.approvedInterestRate
                                                (notify)="getSchedule($event)"
                                                id="s-template">
                                                </schedule-template>
                                            <!-- 
                                                <div class="form-group">
                                                    <label i18n for="" class="control-label col-md-2">Repricing Mode</label>
                                                    <div class="col-md-4">
                                                        <select name="repricingModeId" id="repricingModeId" formControlName="repricingModeId"
                                                            class="form-control" [ngClass]="!loanBookingForm.controls['repricingModeId'].valid ? 'required-input' : 'valid-input'">
                                                            <option value="">Select Repricing Mode</option>
                                                            <option *ngFor="let b of repricingMode" value="{{b.lookupId}}">
                                                                {{b.lookupName}}
                                                            </option>
                                                        </select>
                                                    </div>
                                                </div> -->
                                            </div>
                                           
                                        </div>
                                        <!-- {{visibleSubmit}}  -->
                                    </div>
                                </p-tabPanel >
                            </p-tabView>
                            <div class="panel-footer">
                                <div class="row">
                                    <div class="col-md-12">
                                        <button i18n type="button" (click)="submitLoanDetails()" [disabled]="!loanBookingForm.valid || !canBook || !casaAccountSelected"
                                            class="btn btn-success pull-right">Book Loan</button>
                                        <button type="button" class="btn btn-default" (click)="displayJobrequest=true" style="margin-right:5px">
                                            <i class="glyphicon glyphicon-check"></i> <span i18n>Initiate Request</span></button>
                                        <button (click)="showReferBackForm()" type="button" class="btn btn-danger" style="margin-right:5px">
                                            <ng-container i18n> Refer Back</ng-container>
                                        </button>
                                        <button i18n style="margin-right:5px" type="button" class="btn btn-danger pull-right" (click)="BackToLoanBookingGridList()">Cancel</button>
                                        <button *ngIf="loanSelection != null && loanSelection.isLineFacility == true  && loanSelection.isLineMaintained == false" type="button" class="btn btn-info" (click)="maintainLine()" style="margin-right:5px">
                                            <i class="glyphicon glyphicon-check"></i><ng-container i18n>Maintain Facility Line</ng-container></button>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div *ngIf="showEditLoan"  class="card no-padding">
                        Edittable Content
                    </div>
                </div>
            </div>
        </div>

        <div class="panel-footer">
            <div class="row">
                <div class="col-md-12">
                </div>
            </div>
        </div>
    </div>
</div>

<fintrakbanking-message [title]="title" [message]="message" [show]="show" [cssClass]="cssClass" (closeEvent)="hideMessage($event)">
</fintrakbanking-message>

<p-dialog [responsive]=true [(visible)]="displayBeneficiaryForm" id="ct-modal" modal="modal" showEffect="fade" width="450">
    <div style="margin-bottom:0" class="panel panel-default">
        <div class="panel-heading">
            <h2 i18n class="panel-title">
                Loan Beneficiary Form
            </h2>
        </div>

        <form novalidate [formGroup]="beneficiaryForm" autocomplete="off">
            <div class="panel-body">
                <div class="form-horizontal">
                    <div class="form-group">
                        <label for="beneficiaryAmount" class="control-label col-md-4"><span i18n>Amount</span> ({{destinationCurrencyCode}})</label>
                        <div class="col-md-8 ">
                                <input  type="text" formartM formControlName="beneficiaryAmount" (blur)="formatFeeValue()" [(ngModel)]="data.beneficiaryAmount" class="form-control" [ngClass]="!beneficiaryForm.controls['beneficiaryAmount'].valid ? 'required-input' : 'valid-input'">
                        </div>
                    </div>
                    <div class="form-group">
                        <label i18n for="beneficiaryReason" class="control-label col-md-4">Narration</label>
                        <div class="col-md-8 ">
                            <textarea class="col-md-4" type="text" formControlName="beneficiaryReason" [(ngModel)]="beneficiaryReason" class="form-control" [ngClass]="!beneficiaryForm.controls['beneficiaryReason'].valid ? 'required-input' : 'valid-input'"></textarea>
                        </div>
                    </div>
                </div>
            </div>
        </form>
        <div class="panel-footer">
            <div class="row">
                <div class="col-md-12">
                    <button i18n type="button" (click)="displayBeneficiaryForm=false" style="margin-right:5px" class="btn btn-danger pull-right">Cancel</button>
                    <button i18n type="button" (click)="addToList(beneficiaryForm)" style="margin-right:5px" class="btn btn-success pull-right">Add</button>
                </div>
            </div>
        </div>
    </div>
</p-dialog>

<p-dialog [responsive]=true [(visible)]="displayDocument" modal="modal" showEffect="fade" width="1200">
    <div *ngIf="displayDocument" style="margin-bottom:0" class="panel panel-default">

        <div class="panel-heading">
            <h2   class="panel-title">
               <ng-container i18n>Document Title:</ng-container>
                <strong>{{ selectedDocument }}</strong>
            </h2>
            <div class="pull-right">
                <a class="close" (click)="displayDocument=false">&times;</a>
            </div>
        </div>
        <div class="panel-body" style="overflow:auto;height:450px">
            <img *ngIf="binaryFile" style="max-width: 100%; display: block 2px black;" [src]="'data:image/jpg;base64,'+binaryFile" alt=""
                class="img-thumbnail">
        </div>
    </div>
</p-dialog>

<!--modal ends-->

<p-dialog [responsive]=true [(visible)]=displayJobrequest showHeader="false" id="Job-request-modal" modal="modal" showEffect="fade"
    width="700">
    <div *ngIf="loanApplicationDetailId != null">
        <job-request-template 
            [targetId]=loanApplicationDetailId
            [jobSourceId]= jobSourceId 
            [operationAvailable]="true" 
            [operationsId]=1 
            (displayOption)="CallRequestClose()">
        </job-request-template>
    </div>
</p-dialog>

<!-- <p-dialog [responsive]=true [(visible)]="showCollateralInformation" id="charge-modal" modal="modal" width="1000"> -->
    <!-- <collateral-information-view [reload]="reload" [jobReply]="false" [showCollateralInformation]="showCollateralInformation" (closeWindow)="closeCollateralDetaits($event)" [collateralCustomerId]="collateralCustomerId">
    </collateral-information-view> -->
<!-- </p-dialog> -->
<p-dialog [responsive]=true [(visible)]="displayDocument" modal="modal" showEffect="fade" width="1200">
    <div style="margin-bottom:0" class="panel panel-default">

        <div class="panel-heading">
            <h2 class="panel-title">
                <ng-container i18n>Document Title:</ng-container>
                <strong>{{ selectedDocument }}</strong>
            </h2>
            <div class="pull-right"><a class="close" (click)="displayDocument=false">&times;</a></div>
        </div>

        <div class="panel-body" style="overflow:auto;height:450px">

            <img *ngIf="binaryFile" style="max-width: 100%; display: block 2px black;" [src]="'data:image/jpg;base64,'+binaryFile" alt="" class="img-thumbnail">

        </div>

    </div>
</p-dialog> 
<p-dialog [responsive]=true [(visible)]="displayTwoFactorAuth" id="auth-token" modal="modal" showEffect="fade" width="450">
    <div style="margin-bottom:0" class="panel panel-default">
        <div class="panel-heading">
            <h2 i18n class="panel-title">
                Authentication Token
            </h2>
            <div class="pull-right">
                <a class="close" (click)="displayTwoFactorAuth=false">&times;</a>
            </div>
        </div>
        <div class="panel-body">
            <div class="form-horizontal">
                <div class="form-group">
                    <label i18n for="twoFactorAuthStaffCode" class="control-label col-md-12">Staff Code</label>
                    <div class="col-md-12">
                        <input type="text" name="twoFactorAuthStaffCode" [(ngModel)]="twoFactorAuthStaffCode" id="twoFactorAuthStaffCode" class="form-control">
                    </div>
                </div>
                <div class="form-group">
                    <label i18n for="twoFactorAuthPassCode" class="control-label col-md-12">Pass Code</label>
                    <div class="col-md-12">
                        <input type="password" name="twoFactorAuthPassCode" [(ngModel)]="twoFactorAuthPassCode" id="twoFactorAuthPassCode" class="form-control">
                    </div>
                </div>
            </div>
        </div>
        <div class="panel-footer ">
            <div class="row ">
                <div class="col-md-12 ">
                    <div class="form-group text-center">
                        <div class="col-md-12">
                            <button i18n type="button" [disabled]="!twoFactorAuthPassCode" (click)="submitLoanDetailsWith2FA()" style="margin-right:5px "
                                class="btn btn-info btn-lg btn-block text-uppercase waves-effect waves-light">Authenticate</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</p-dialog>

<p-dialog [responsive]=true [(visible)]="displayReport" width="800" modal="modal" showEffect="fade">
        <div class="panel panel-default">
            <div class="panel-heading">
                <div class="row">
                    <div class="col-md-12">
                        <h2 i18n class="panel-title pull-left">
                            Generated Offer Letter
                        </h2>
                        <button i18n type="button" (click)="displayReport=false" style="margin-right:5px" class="btn btn-danger pull-right">Cancel</button>
                    </div>
                </div>
            </div>
            <div class="panel-body">
                <div class="col-md-12" *ngIf="displayTestReport" style=" width:1200px; overflow:auto;">
                    <iframe [src]="reportSrc" id="report" name="report" frameborder="2" height="500px" width="1500px" style="overflow:auto"></iframe>
                </div>
            </div>
        </div>
        <div class="panel-footer">
            <div class="row">
                <div class="col-md-12">
                    <button i18n type="button" (click)="displayReport=false" style="margin-right:5px" class="btn btn-danger pull-right">Cancel</button>
                </div>
            </div>
        </div>
    </p-dialog>

    <p-dialog [responsive]=true [(visible)]="displayOperationRouteCommentForm" modal="modal" showEffect="fade" width="450">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h2 i18n class="panel-title">
                    Re-route
                </h2>
                <div class="pull-right">
                    <a class="close" (click)="displayOperationRouteCommentForm = false">&times;</a>
                </div>
            </div>
        </div>
    
        <div class="panel-body">
            <form novalidate [formGroup]="operationForm" autocomplete="off">
                <div class="form-horizontal">
                                    
                    <!-- <div class="form-group">
                        <label i18n class="control-label col-md-6">Operation</label>
                        <div class="col-md-12">
                            <select (change)="onOperationChange($event.target.value)" name="operationId" formControlName="operationId" id="operationId" class="form-control" [ngClass]="operationForm.controls['operationId'].valid ? 'valid-input' : 'required-input'">
                                <option value="" i18n>-- Select Operation --</option>
                                <option *ngFor="let x of routeableOperations" [value]="x.id">{{ x.name }}</option>
                            </select>
                        </div>
                    </div> -->
    
                    <div class="form-group">
                        <label i18n class="control-label col-md-6">Approval Level</label>
                        <div class="col-md-12">
                            <select name="approvalLevelId" formControlName="approvalLevelId" id="approvalLevelId" class="form-control" [ngClass]="operationForm.controls['approvalLevelId'].valid ? 'valid-input' : 'required-input'">
                                <option value="" i18n>-- Select Approval Level --</option>
                                <option *ngFor="let x of approvalLevels" [value]="x.approvalLevelId">{{ x.approvalLevelAndRoleName }}</option>
                            </select>
                        </div>
                    </div>
    
                    <div class="form-group">
                        <label i18n class="control-label col-md-12">Comment</label>
                        <div class="col-md-12">
                            <textarea style="height:60px;" name="comment" formControlName="comment" id="comment" class="form-control" [ngClass]="operationForm.controls['comment'].valid ? 'valid-input' : 'required-input'"></textarea>
                        </div>
                    </div>
                </div>
            </form>
            <div *ngIf="errorMessage.length > 0" class="alert alert-danger col-md-12" role="alert" style="padding:15;">
                <span class="glyphicon glyphicon-exclamation-sign" aria-hidden="true"></span>
                <span class="sr-only">Error: </span>{{ errorMessage }}
            </div>
        </div>
    
        <div class="panel-footer">
            <div class="form-horizontal">
                <div class="form-group">
                    <div class="col-md-12" style="text-align:right">
                        <button i18n type="button" (click)="displayOperationRouteCommentForm = false" class="btn btn-danger">Cancel</button>
                        <button type="button"  [disabled]="operationForm.invalid" (click)="returnBackToRM()" class="btn btn-success">
                            <span class="glyphicon glyphicon-send"></span><ng-container i18n>Send</ng-container></button>
                    </div>
                </div>
            </div>
        </div>
    
    </p-dialog>

    <p-dialog [responsive]=true [(visible)]="displayReferBackForm" modal="modal" showEffect="fade" width="700">
        <div style="margin-bottom:0" class="panel panel-default">
            <app-refer-back *ngIf="displayReferBackForm == true"
                [isClassified]="true" [forbidExternalNotification]="true" 
                (notify)="displayStatus($event)"
                (notifyAfterReferBack)="referBackResultControl($event)"
                [referBackOperationId]="loanSelection?.operationId"
                [referBackTargetId]="loanSelection?.loanBookingRequestId">
            </app-refer-back>
        </div>
    </p-dialog>


<!-- <pre> {{ loanSelection.productTypeName.toLowerCase() | json }}</pre> 
<pre> loanBookingForm value {{ loanBookingForm.value | json }}</pre i18n>-->
 <!-- <pre> loanBookingForm invalid {{ !loanBookingForm.valid | json }}</pre>
<pre> cannot Book {{ !canBook | json }}</pre>
<pre> charge Collection count: {{ chargeCollection.length == 0 | json }}</pre>
<pre> casa Account not Selected : {{ !casaAccountSelected | json }}</pre> -->