<div class="ui-g">
    <div class="ui-g-12 no-padding">
        <div class="card no-padding">
            <div *ngIf="!displayInitiationForm" class="panel panel-default">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-md-12">
                            <h2 i18n class="panel-title pull-left">
                                DrawDown Initiation
                            </h2>
                        </div>
                    </div>
                </div>

                <div class="row">

                    <div class="pull-right" style="margin-right:16px;margin-bottom:2px;">
                        <input *ngIf="isMultipleDrawdown" type="search" [(ngModel)]="searchString" id="searchString"
                            name="searchString"  i18n-placeholder placeholder="Search by Reference Number..." aria-label="Search"
                            size="30" minlength="4" maxlength="50">
                        <button i18n *ngIf="isMultipleDrawdown" (click)="getApplicationFacilities()">Search</button>

                        <input type="checkbox" (change)="setMultipleDrawdown($event.target.checked)"
                            name="multipleDrawdown">
                        <label i18n for="multipleDrawdown"> Use Multiple Drawdown</label>
                    </div>
                </div>
                <div *ngIf="isMultipleDrawdown && multiplefacilities != null" class="panel-body">
                    <div class="card no-padding">
                        <div class="card no-padding">
                            <!-- resizableColumns="true" -->
                            <p-dataTable [paginator]="false"  [responsive]="true"
                                [value]="multiplefacilities" selectionMode="multiplefacilities"
                                (onRowSelect)="pushSelectedLoans($event)" (onRowUnselect)="popSelectedLoans($event)">
                                <p-header i18n-header>Multiple Facility Drawdown</p-header>
                                <p-column [style]="{'width':'38px'}" selectionMode="multiple"></p-column>

                                <!-- <p-column i18n-header field="availmentDate" header="Availed On" [filter]="true" filterMatchMode="contains">
                                       <ng-template let-i="rowIndex" let-row="rowData" pTemplate type="body">
                                        {{ row.availmentDate | date}}
                                          </ng-template>
                                </p-column> -->

                                <!-- <p-column i18n-header field="systemArrivalDate" header="Availed On" [filter]="true" filterMatchMode="contains">
                                    <ng-template let-i="rowIndex" let-row="rowData" pTemplate type="body">
                                        <span *ngIf="row.availmentDate != null">{{ row.availmentDate | date}}</span>
                                        <span *ngIf="row.availmentDate == null">{{ row.availmentDate | date}}</span>
                                    </ng-template>
                                </p-column> -->

                                <!-- <p-column i18n-header field="loanTypeName" header="Type" sortable="true" [filter]="true" filterMatchMode="contains"></p-column> -->
                                <p-column i18n-header [style]="{'width':'150px'}" field="productTypeName" header="Facility Type"
                                    sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                                <p-column i18n-header [style]="{'width':'150px'}" field="productName" header="Facility Name"
                                    sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                                <p-column i18n-header field="applicationReferenceNumber" header="Ref No" sortable="true"
                                    [filter]="true" filterMatchMode="contains"></p-column>
                                <p-column i18n-header [style]="{'width':'150px'}" field="customerName" header="Obligor Name" 
                                    sortable="true" [filter]="true" filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        <span *ngIf="item.loanTypeId == 3">{{item.applicantName}}</span>
                                        <span *ngIf="item.loanTypeId != 3">{{item.customerName}}</span>
                                    </ng-template>
                                </p-column>
                                <p-column i18n-header [style]="{'text-align':'right','width':'115px'}" field="approvedAmount"
                                    header="Approved Amount" sortable="true" [filter]="true" filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        {{item.approvedAmount | currency:item.currencyCode:true: '1.2-2'}}
                                    </ng-template>
                                </p-column>
                                <p-column i18n-header [style]="{'text-align':'right','width':'115px'}" field="amountDisbursed"
                                    header="Disbursed Amount" sortable="true" [filter]="true"
                                    filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        {{item.amountDisbursed | currency:item.currencyCode:true: '1.2-2'}}
                                    </ng-template>
                                </p-column>
                                <p-column i18n-header [style]="{'text-align':'right','width':'115px'}" field="allRequestAmount"
                                    header="Requested Amount" sortable="true" [filter]="true"
                                    filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        {{item.allRequestAmount | currency:item.currencyCode:true: '1.2-2'}}
                                    </ng-template>
                                </p-column>

                                <p-column i18n-header [style]="{'width':'50px'}" field="interestRate" header="Interest"
                                    [filter]="true" filterMatchMode="contains"></p-column>
                                <p-column i18n-header [style]="{'width':'80px'}" field="approvedTenor" header="Tenor"
                                    sortable="true" [filter]="true" filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        {{item.approvedTenorString}}
                                    </ng-template>
                                </p-column>
                            </p-dataTable>

                            <div *ngIf="showProceedButtton" class="col-md-12 ">
                                <button i18n type="button" (click)="proceedFirstOfSelectedMultiples()"
                                    style="margin-right:5px"
                                    class="btn btn-info btn-lg btn-block text-uppercase waves-effect waves-light">Proceed</button>
                            </div>

                        </div>
                    </div>
                </div>
                <div *ngIf="!isMultipleDrawdown" class="panel-body">
                    <div class="card no-padding">
                        <div class="card no-padding">
                            <p-dataTable [paginator]="true"  [responsive]="true" [value]="loans" [rows]="5"
                                selectionMode="single" (onRowSelect)="onSelectedLoanChange($event.data)">
                                <p-header i18n-header>APPROVED FACIITIES</p-header>
                                <p-column [style]="{'width':'38px'}" selectionMode="single"></p-column>
                                <p-column i18n-header [style]="{'width':'100px'}" field="availmentDate" header="Date Recieved"
                                    sortable="true" [filter]="true" filterMatchMode="contains">
                                    <ng-template let-i="rowIndex" let-row="rowData" pTemplate type="body">
                                        <span *ngIf="row.availmentDate != null">{{ row.availmentDate | date: 'medium' }}</span>
                                        <span i18n *ngIf="row.availmentDate == null"> N/A </span>
                                    </ng-template>
                                </p-column>
                                <p-column i18n-header [style]="{'width':'100px'}" field="loanTypeName" header="Type" sortable="true"
                                    [filter]="true" filterMatchMode="contains"></p-column>

                                <p-column i18n-header [style]="{'width':'70px'}" field="productTypeName" header="Facility Type"
                                    sortable="true" [filter]="true" filterMatchMode="contains"></p-column>

                                <p-column i18n-header [style]="{'width':'70px'}" field="productClassName" header="Class"
                                    sortable="true" [filter]="true" filterMatchMode="contains"></p-column>

                                <p-column i18n-header [style]="{'width':'100px'}" field="applicationReferenceNumber" header="Ref No"
                                    sortable="true" [filter]="true" filterMatchMode="contains"></p-column>

                                <p-column i18n-header [style]="{'width':'50px'}" field="isLineFacilityString" header="Is A Line"
                                    sortable="true" [filter]="true" filterMatchMode="contains"></p-column>

                                <p-column i18n-header [style]="{'width':'100px'}" field="customerName" header="Obligor Name"
                                    sortable="true" [filter]="true" filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        <span *ngIf="item.loanTypeId == 3">{{item.applicantName}}</span>
                                        <span *ngIf="item.loanTypeId != 3">{{item.customerName}}</span>
                                    </ng-template>
                                </p-column>
                                <p-column i18n-header [style]="{'text-align':'right','width':'100px'}" field="approvedAmount"
                                    header="Approved Amount" sortable="true" [filter]="true" filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        {{item.approvedAmount | currency:item.currencyCode:true: '1.2-2'}}
                                    </ng-template>
                                </p-column>

                                <p-column i18n-header [style]="{'text-align':'right','width':'100px'}" field="amountDisbursed"
                                    header="Disbursed Amount" sortable="true" [filter]="true"
                                    filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        {{item.amountDisbursed | currency:item.currencyCode:true: '1.2-2'}}
                                    </ng-template>
                                </p-column>
                                <p-column i18n-header [style]="{'text-align':'right','width':'120px'}" field="allRequestAmount"
                                    header="Requested Amount" sortable="true" [filter]="true"
                                    filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        {{item.allRequestAmount | currency:item.currencyCode:true: '1.2-2'}}
                                    </ng-template>
                                </p-column>
                                <p-column i18n-header [style]="{'width':'50px'}" field="interestRate" header="Interest"
                                    [filter]="true" filterMatchMode="contains"></p-column>
                                <p-column i18n-header [style]="{'width':'80px'}" field="approvedTenor" header="Tenor"
                                    sortable="true" [filter]="true" filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        {{item.approvedTenorString}}
                                    </ng-template>
                                </p-column>

                                <p-column i18n-header [style]="{'width':'100px'}" field="approvalStatusName"
                                    header="Approval Status" [filter]="true" filterMatchMode="contains">
                                </p-column>
                            </p-dataTable>
                        </div>

                        <p-accordion #accordion1>
                            <p-accordionTab i18n-header [selected]="true" header="Approved Employer Related Requests For Draw-down Initiation">
                                <div class="pull-right" style="margin-right:16px;margin-bottom:2px;">
                                    <input type="search" [(ngModel)]="EmployerSearchString" id="EmployerSearchString" name="EmployerSearchString"
                                         i18n-placeholder placeholder="Search loan application(s)..." aria-label="Search" size="50"
                                        minlength="2" maxlength="50">
                                    <button i18n (click)="getGlobalApprovedEmployerApplications()">Search</button>
                                    <button i18n-title (click)="resetEmployerRelatedLoans()" title="Refresh">
                                        <span class="glyphicon glyphicon-refresh"></span>
                                    </button>
                                </div>
                                <br/>
                                <br/>

                                <div class="card no-padding">
                                    <p-dataTable [paginator]="true"  [responsive]="true" [value]="employerRelatedLoans" [rows]="5"
                                        selectionMode="single" (onRowSelect)="onSelectedLoanChange($event.data)">
                                        <p-header i18n-header>APPROVED EMPLOYER RELATED FACIITIES</p-header>
                                        <p-column [style]="{'width':'38px'}" selectionMode="single"></p-column>
                                        <p-column i18n-header [style]="{'width':'100px'}" field="availmentDate" header="Date Recieved"
                                            [filter]="true" filterMatchMode="contains">
                                            <ng-template let-i="rowIndex" let-row="rowData" pTemplate type="body">
                                                <span *ngIf="row.availmentDate != null">{{ row.availmentDate | date: 'medium' }}</span>
                                                <span i18n *ngIf="row.availmentDate == null"> N/A </span>
                                            </ng-template>
                                        </p-column>
                                        <p-column i18n-header [style]="{'width':'100px'}" field="loanTypeName" header="Type" sortable="true"
                                            [filter]="true" filterMatchMode="contains"></p-column>
        
                                        <p-column i18n-header [style]="{'width':'70px'}" field="productTypeName" header="Facility Type"
                                            sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
        
                                        <p-column i18n-header [style]="{'width':'70px'}" field="productClassName" header="Class"
                                            sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
        
                                        <p-column i18n-header [style]="{'width':'100px'}" field="applicationReferenceNumber" header="Ref No"
                                            sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
        
                                        <p-column i18n-header [style]="{'width':'50px'}" field="isLineFacilityString" header="Is A Line"
                                            sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
        
                                        <p-column i18n-header [style]="{'width':'100px'}" field="customerName" header="Obligor Name"
                                            sortable="true" [filter]="true" filterMatchMode="contains">
                                            <ng-template pTemplate="body" let-item="rowData">
                                                <span *ngIf="item.loanTypeId == 3">{{item.applicantName}}</span>
                                                <span *ngIf="item.loanTypeId != 3">{{item.customerName}}</span>
                                            </ng-template>
                                        </p-column>
                                        <p-column i18n-header [style]="{'text-align':'right','width':'100px'}" field="approvedAmount"
                                            header="Approved Amount" sortable="true" [filter]="true" filterMatchMode="contains">
                                            <ng-template pTemplate="body" let-item="rowData">
                                                {{item.approvedAmount | currency:item.currencyCode:true: '1.2-2'}}
                                            </ng-template>
                                        </p-column>
        
                                        <p-column i18n-header [style]="{'text-align':'right','width':'100px'}" field="amountDisbursed"
                                            header="Disbursed Amount" sortable="true" [filter]="true"
                                            filterMatchMode="contains">
                                            <ng-template pTemplate="body" let-item="rowData">
                                                {{item.amountDisbursed | currency:item.currencyCode:true: '1.2-2'}}
                                            </ng-template>
                                        </p-column>
                                        <p-column i18n-header [style]="{'text-align':'right','width':'120px'}" field="allRequestAmount"
                                            header="Requested Amount" sortable="true" [filter]="true"
                                            filterMatchMode="contains">
                                            <ng-template pTemplate="body" let-item="rowData">
                                                {{item.allRequestAmount | currency:item.currencyCode:true: '1.2-2'}}
                                            </ng-template>
                                        </p-column>
                                        <p-column i18n-header [style]="{'width':'50px'}" field="interestRate" header="Interest"
                                            [filter]="true" filterMatchMode="contains"></p-column>
                                        <p-column i18n-header [style]="{'width':'80px'}" field="approvedTenor" header="Tenor"
                                            sortable="true" [filter]="true" filterMatchMode="contains">
                                            <ng-template pTemplate="body" let-item="rowData">
                                                {{item.approvedTenorString}}
                                            </ng-template>
                                        </p-column>
        
                                        <p-column i18n-header [style]="{'width':'100px'}" field="approvalStatusName"
                                            header="Approval Status" [filter]="true" filterMatchMode="contains">
                                        </p-column>
                                    </p-dataTable>
                                </div>
                            </p-accordionTab>
                        </p-accordion>
                        <br/>

                        <div class="card no-padding">
                            <p-dataTable [paginator]="true" [responsive]="true" [value]="referedDrawdownItems" [rows]="5"
                                selectionMode="single" (onRowSelect)="onSelectedLoanChange($event.data)">
                                <p-header i18n-header>REFERED REQUEST</p-header>
                                <p-column [style]="{'width':'38px'}" selectionMode="single"></p-column>
                                <p-column i18n-header [style]="{'width':'100px'}" field="systemArrivalDate" header="Date Received"
                                    [filter]="true" filterMatchMode="contains">
                                    <ng-template let-i="rowIndex" let-row="rowData" pTemplate type="body">
                                        <span *ngIf="row.availmentDate != null">{{ row.availmentDate | date}}</span>
                                        <span i18n *ngIf="row.availmentDate == null"> N/A </span>
                                    </ng-template>
                                </p-column>
                                <p-column i18n-header [style]="{'width':'100px'}" field="loanTypeName" header="Type" sortable="true"
                                    [filter]="true" filterMatchMode="contains"></p-column>

                                <p-column i18n-header [style]="{'width':'70px'}" field="productTypeName" header="Facility Type"
                                    sortable="true" [filter]="true" filterMatchMode="contains"></p-column>

                                <p-column i18n-header [style]="{'width':'70px'}" field="productClassName" header="Class"
                                    sortable="true" [filter]="true" filterMatchMode="contains"></p-column>

                                <p-column i18n-header [style]="{'width':'100px'}" field="applicationReferenceNumber" header="Ref No"
                                    sortable="true" [filter]="true" filterMatchMode="contains"></p-column>

                                <p-column i18n-header [style]="{'width':'100px'}" field="customerName" header="Obligor Name"
                                    sortable="true" [filter]="true" filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        <span *ngIf="item.loanTypeId == 3">{{item.applicantName}}</span>
                                        <span *ngIf="item.loanTypeId != 3">{{item.customerName}}</span>
                                    </ng-template>
                                </p-column>
                                <p-column i18n-header [style]="{'text-align':'right','width':'100px'}" field="approvedAmount"
                                    header="Approved Amount" sortable="true" [filter]="true" filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        {{item.approvedAmount | currency:item.currencyCode:true: '1.2-2'}}
                                    </ng-template>
                                </p-column>

                                <p-column i18n-header [style]="{'text-align':'right','width':'100px'}" field="amountDisbursed"
                                    header="Disbursed Amount" sortable="true" [filter]="true"
                                    filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        {{item.amountDisbursed | currency:item.currencyCode:true: '1.2-2'}}
                                    </ng-template>
                                </p-column>
                                <p-column i18n-header [style]="{'text-align':'right','width':'120px'}" field="allRequestAmount"
                                    header="Requested Amount" sortable="true" [filter]="true"
                                    filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        {{item.allRequestAmount | currency:item.currencyCode:true: '1.2-2'}}
                                    </ng-template>
                                </p-column>
                                <p-column i18n-header [style]="{'width':'50px'}" field="interestRate" header="Interest"
                                    [filter]="true" filterMatchMode="contains"></p-column>
                                <p-column i18n-header [style]="{'width':'80px'}" field="approvedTenor" header="Tenor"
                                    sortable="true" [filter]="true" filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        {{item.approvedTenorString}}
                                    </ng-template>
                                </p-column>

                                <p-column i18n-header [style]="{'width':'100px'}" field="approvalStatusName"
                                    header="Approval Status" [filter]="true" filterMatchMode="contains">
                                </p-column>
                            </p-dataTable>
                        </div>
                    </div>
                </div>
            </div>

            <div *ngIf="displayInitiationForm" style="margin-bottom:0" class="panel panel-default">
                <div class="panel-heading">
                    <h2 class="panel-title">
                        Draw down Initiation for
                        <strong>
                            <span *ngIf="loanTypeId == 3">{{ applicantName }}</span>
                            <span *ngIf="loanTypeId != 3">{{ customerName }}</span>
                        </strong>
                    </h2>
                    <div class="pull-right">
                        <a class="close" (click)="closeDialog()">&times;</a>
                    </div>
                </div>
                <form novalidate [formGroup]="initiationForm" autocomplete="off">
                    <p-tabView>
                        <p-tabPanel i18n-header  header="Customer Request">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <h2 class="panel-title pull-left">
                                                <span i18n>DrawDown Request Details </span><i *ngIf="isProspective" style="color: red; font-size: small;"><span i18n>(this customer is a Prospective Customer)</span></i>
                                            </h2>
                                            <div class="pull-right">
                                                <button pButton type="button" (click)="fetchAndAddCustomerAccounts()"
                                                    i18n-label label="Refresh Customer Accounts" class="ui-button-info">
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="panel-body">
                                    <p-dataTable *ngIf="isMultipleDrawdown" [paginator]="false" resizableColumns="true"
                                        [responsive]="true" [value]="drawdownFacilitiesInformation"
                                        selectionMode="single" (onRowSelect)="onSelectedLoanChange($event.data)"
                                        (onRowUnselect)="popSelectedLoans($event)">
                                        <p-header i18n-header>Multiple Facility Drawdown</p-header>
                                        <!-- <p-column i18n-header [style]="{'width':'38px'}" selectionMode="multiple"></p-column> -->
                                        <p-column i18n-header [style]="{'width':'150px'}" field="productTypeName"
                                            header="Facility Type" sortable="true" [filter]="true"
                                            filterMatchMode="contains"></p-column>
                                        <p-column i18n-header [style]="{'width':'150px'}" field="productName" header="Facility Name"
                                            sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                                        <p-column i18n-header field="applicationReferenceNumber" header="Ref No" sortable="true"
                                            [filter]="true" filterMatchMode="contains"></p-column>
                                        <p-column i18n-header [style]="{'width':'150px'}" field="customerName" header="Obligor Name"
                                            sortable="true" [filter]="true" filterMatchMode="contains">
                                            <ng-template pTemplate="body" let-item="rowData">
                                                <span *ngIf="item.loanTypeId == 3">{{item.applicantName}}</span>
                                                <span *ngIf="item.loanTypeId != 3">{{item.customerName}}</span>
                                            </ng-template>
                                        </p-column>
                                        <p-column i18n-header [style]="{'text-align':'right','width':'115px'}"
                                            field="approvedAmount" header="Approved Amount" sortable="true"
                                            [filter]="true" filterMatchMode="contains">
                                            <ng-template pTemplate="body" let-item="rowData">
                                                {{item.approvedAmount | currency:item.currencyCode:true: '1.2-2'}}
                                            </ng-template>
                                        </p-column>
                                        <p-column i18n-header [style]="{'text-align':'right','width':'115px'}"
                                            field="amountDisbursed" header="Disbursed Amount" sortable="true"
                                            [filter]="true" filterMatchMode="contains">
                                            <ng-template pTemplate="body" let-item="rowData">
                                                {{item.amountDisbursed | currency:item.currencyCode:true: '1.2-2'}}
                                            </ng-template>
                                        </p-column>
                                        <p-column i18n-header [style]="{'text-align':'right','width':'115px'}"
                                            field="allRequestAmount" header="Requested Amount" sortable="true"
                                            [filter]="true" filterMatchMode="contains">
                                            <ng-template pTemplate="body" let-item="rowData">
                                                {{item.allRequestAmount | currency:item.currencyCode:true: '1.2-2'}}
                                            </ng-template>
                                        </p-column>
                                        <p-column i18n-header [style]="{'text-align':'right','width':'115px'}"
                                            field="bookingAmountRequested" header="New Request Amount" sortable="true"
                                            [filter]="true" filterMatchMode="contains">
                                            <ng-template pTemplate="body" let-item="rowData">
                                                {{item.bookingAmountRequested ? item.bookingAmountRequested : 0 | currency:item.currencyCode:true: '1.2-2'}}
                                            </ng-template>
                                        </p-column>
                                        <p-column i18n-header [style]="{'width':'50px'}" field="interestRate" header="Interest"
                                            [filter]="true" filterMatchMode="contains"></p-column>
                                        <p-column i18n-header [style]="{'width':'80px'}" field="approvedTenor" header="Tenor"
                                            sortable="true" [filter]="true" filterMatchMode="contains">
                                            <ng-template pTemplate="body" let-item="rowData">
                                                {{item.approvedTenorString}}
                                            </ng-template>
                                        </p-column>
                                    </p-dataTable>
                                </div>
                                <div class="panel-body"> 
                                    <div class="form-horizontal">
                                        <div *ngIf="showBeneficiary" class="form-group">
                                            <label i18n for="productId" class="control-label col-md-2">Beneficiary</label>
                                            <div class="col-md-8">
                                                <strong>{{selectedBeneficiary.toUpperCase()}}</strong>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label i18n for="productId" class="control-label col-md-2">Product</label>
                                            <div class="col-md-8">
                                                <select name="productId" id="productId" formControlName="productId"
                                                    class="form-control"
                                                    [ngClass]="!initiationForm.controls['productId'].valid ? 'required-input' : 'valid-input'">
                                                    <option value="" i18n>-- Select Product --</option>
                                                    <option *ngFor="let x of filteredProducts" [value]="x.productId"> 
                                                        {{ x.productName }}</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div *ngIf="!isMultipleDrawdown" class="form-group">
                                            <label i18n for="documentTitle" class="control-label col-md-2">Document Title</label>
                                            <div class="col-md-8 no-data-div">
                                                <input type="text" [(ngModel)]="uploadFileTitle" class="form-control" 
                                                    name="docDescription" formControlName="docDescription"
                                                    [ngClass]="initiationForm.controls['docDescription'].valid ? 'valid-input' : 'required-input'"
                                                     i18n-placeholder placeholder="Customer Request Document">
                                            </div>
                                        </div>
                                        <!-- <div *ngIf="!isMultipleDrawdown" class="form-group">
                                            <label i18n for="document" class="control-label col-md-2">Select Document</label>
                                            <div class="col-md-8">
                                                <input type="file" (change)="onFileChange($event)"  i18n-placeholder placeholder="Upload file" accept=".pdf,.doc,.docx,.jpg,.jpeg" #fileInput name="fileInput" style="padding-top:2px;" class="form-control">
                                            </div>
                                        </div> -->
                                        <div class="form-group">
                                            <label for="approvedAmount" class="control-label col-md-2"><span i18n>Approved Amount</span>
                                                ({{loanSelection.currencyCode}})</label>
                                            <div class="col-md-8">
                                                <input type="text" [attr.disabled]="true" formartM class="form-control"
                                                    name="approvedAmount" formControlName="approvedAmount"
                                                    [ngClass]="initiationForm.controls['approvedAmount'].valid ? 'valid-input' : 'required-input'"
                                                    class="form-control"  i18n-placeholder placeholder="0.00">
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="availableAmount" class="control-label col-md-2"><span i18n>Available  Amount</span> ({{loanSelection.currencyCode}})</label>
                                            <div class="col-md-8">
                                                <input type="text" [attr.disabled]="true" formartM class="form-control"
                                                    name="availableAmount" formControlName="availableAmount"
                                                    [ngClass]="initiationForm.controls['availableAmount'].valid ? 'valid-input' : 'required-input'"
                                                    class="form-control"  i18n-placeholder placeholder="0.00">
                                            </div>
                                        </div>

                                        <!-- <div class="form-group">
                                            <label i18n for="tenor" class="control-label col-md-2">Tenor
                                            </label>
                                            <div class="col-md-8">
                                                <input type="text" (blur)="validateTenor($event.target.value)" formartM class="form-control" name="tenor"
                                                    formControlName="tenor">
                                            </div>
                                        </div> -->


                                        <div class="form-group">
                                            <label for="amountToBook" class="control-label col-md-2"><span i18n>New Request Amount</span>
                                                ({{loanSelection.currencyCode}})</label>
                                            <div class="col-md-8">
                                                <input type="text" formartM class="form-control"
                                                    (blur)="formatFeeValue()" [(ngModel)]="data.bookingAmount"
                                                    name="amountToBook" formControlName="amountToBook"
                                                    [ngClass]="initiationForm.controls['amountToBook'].valid ? 'valid-input' : 'required-input'"
                                                    class="form-control"  i18n-placeholder placeholder="0.00">
                                            </div>
                                        </div>
                                       
                                        
                                        <div *ngIf="!isMultipleDrawdown" class="form-group">
                                            <label for="casaAccountId" *ngIf="!isChecked"
                                                class="control-label col-md-2">{{casaAccountText}}</label>
                                            <label for="casaAccountId" *ngIf="isChecked"
                                                class="control-label col-md-2">{{casaAccountTextProjectRelated}}</label>
                                            <div class="col-md-8">
                                                <select (change)="onCustomerAccountChange($event.target.value)"
                                                    name="casaAccountId" id="casaAccountId"
                                                    formControlName="casaAccountId" class="form-control"
                                                    [ngClass]="!initiationForm.controls['casaAccountId'].valid ? 'required-input' : 'valid-input'">
                                                    <option value="" i18n>-- Select Customer Account --</option>
                                                    <option *ngFor="let x of customerAccounts"
                                                        [value]="x.casaAccountId">{{ x.productAccountNumber }}</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div *ngIf="isMultipleDrawdown" class="form-group">
                                            <label i18n for="document" class="control-label col-md-2"></label>
                                            <div class="col-md-4">
                                                <button (click)="SaveActiveRecordAmount(initiationForm)"
                                                    class="btn btn-sm btn-primary"
                                                    [disabled]="(initiationForm.value.amountToBook == null ) "><span i18n>Save Adjustment</span>
                                                </button>
                                            </div>
                                        </div>
                                        <!-- <div *ngIf="(isCommercialLoan || isIDF) && !isMultipleDrawdown" class="form-group">
                                            <label i18n for="casaAccountId2" class="control-label col-md-2">{{casaAccount2Text}}2</label>
                                            <div class="col-md-8">
                                                <select (change)="onCustomerAccountChange($event.target.value)" name="casaAccountId2" id="casaAccountId2" formControlName="casaAccountId2"
                                                    class="form-control" [ngClass]="!initiationForm.controls['casaAccountId2'].valid ? 'required-input' : 'valid-input'">
                                                    <option value="">-- Select Customer Account --</option>
                                                    <option *ngFor="let x of customerAccounts" [value]="x.casaAccountId">{{ x.productAccountNumber }}</option>
                                                </select>
                                            </div>
                                        </div> -->
                                        <div class="form-group">
                                            <label i18n for="comment" class="control-label col-md-2">Comments:</label>
                                            <div class="col-md-8">
                                                <textarea class="form-control" formControlName="comment"
                                                [ngClass]="initiationForm.controls['comment'].valid ? 'valid-input' : 'required-input'"
                                                class="form-control">
                                                </textarea> 
                                            </div>
                                        </div>
                                        <div class="form-group" *ngIf="(loanSelection.isProjectRelate == true && loanSelection.isLineFacility == false) || (loanSelection.isProjectRelate == true && loanSelection.isLineFacility == true && loanSelection.isLineMaintained == true)">
                                        <br/>
                                        <div class="form-group">
                                            <label i18n for="isProjectRelated" class="control-label col-md-2">Project Related:</label>
                                            <div class="col-md-8">
                                                <!-- <div class="checkbox-inline actCheckBox"> -->
                                                <input type="checkbox" formControlName="isProjectRelated" (change)="changed($event)" 
                                                name="isProjectRelated" id="isProjectRelated">
                                                <!-- </div> -->
                                            </div>
                                        </div>
                                        </div>
                                        <div class="form-group" *ngIf="loanSelection.isEmployerRelated == true">
                                            <label i18n for="" class="control-label col-md-2">Related Employer:</label>
                                            <div class="col-md-8">
                                                <strong>{{ loanSelection?.employer}}</strong>
                                            </div>
                                        </div>
                                        
                                        <div *ngIf="!isMultipleDrawdown" class="form-group">
                                            <label i18n for="document" class="control-label col-md-2"></label>
                                            <div class="col-md-8">
                                                <!-- [disabled]="(initiationForm.invalid || !casaAccountSelected || !allLiensArePlaced) "><span -->
                                                <button *ngIf="!(loanBookingRequestId > 0)" (click)="initiateDrawdown()"
                                                    class="btn btn-sm btn-primary"
                                                    [disabled]="(initiationForm.invalid || !casaAccountSelected)"><span
                                                        class="glyphicon glyphicon-book"></span><span i18n>Initiate Drawdown></span>
                                                    </button>
                                                <button *ngIf="loanBookingRequestId > 0" (click)="initiateDrawdown()"
                                                    class="btn btn-sm btn-primary"
                                                    [disabled]="(initiationForm.invalid || !casaAccountSelected)"><span
                                                        class="glyphicon glyphicon-book"></span><span i18n>Continue Drawdown</span></button>
                                                    <button  *ngIf="!(initiationForm.invalid || !casaAccountSelected)" type="button" (click)="selectApprover()"
                                                        class="btn btn-default"><span class="glyphicon glyphicon-user"
                                                            style="padding-right:4px;"></span> <span i18n>Select Approver</span>
                                                    </button>
                                                    <button *ngIf="selectedApprover != null && (!(initiationForm.invalid || !casaAccountSelected))" type="button" class="btn btn-default"
                                                    style="border-color:transparent;"><i>{{selectedApprover}}</i></button>
                                                    <button *ngIf="loanSelection.loanTypeId == 2" type="button" (click)="selectMember()"
                                                    class="btn btn-default"><span class="glyphicon glyphicon-user"
                                                        style="padding-right:4px;"></span><ng-container i18n> Select Group Member</ng-container>
                                                        </button>
                                                    <button  *ngIf="loanSelection.isEmployerRelated == true" type="button" (click)="selectCustomerForEmployerRelated()"
                                                    class="btn btn-default"><span class="glyphicon glyphicon-user"
                                                        style="padding-right:4px;"></span> <span i18n>Select Customer</span></button>
                                                <span i18n *ngIf="isLienPlacementForLoan"
                                                    style="color: red; font-weight: bold;">NOTE: LIEN WILL BE PLACED FOR THIS LOAN!</span>
                                            </div>
                                        </div>

                                        <div *ngIf="isMultipleDrawdown">
                                            <hr>
                                            <div class="form-group">
                                                <label i18n for="documentTitle" class="control-label col-md-2">Document Title</label>
                                                <div class="col-md-4 no-data-div">
                                                    <input type="text" [(ngModel)]="uploadFileTitle"
                                                        class="form-control" name="docDescription"
                                                        formControlName="docDescription"
                                                        [ngClass]="initiationForm.controls['docDescription'].valid ? 'valid-input' : 'required-input'"
                                                         i18n-placeholder placeholder="Customer Request Document">
                                                </div>
                                                <label i18n for="document" class="control-label col-md-2">Select Document</label>
                                                <div class="col-md-4">
                                                    <input type="file" (change)="onFileChange($event)"
                                                         i18n-placeholder placeholder="Upload file" accept=".pdf,.doc,.docx,.jpg,.jpeg"
                                                        #fileInput name="fileInput" style="padding-top:2px;"
                                                        class="form-control">
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label for="casaAccountId"
                                                    class="control-label col-md-2">{{casaAccountText}}</label>
                                                <div class="col-md-4">
                                                    <select (change)="onCustomerAccountChange($event.target.value)"
                                                        name="casaAccountId" id="casaAccountId"
                                                        formControlName="casaAccountId" class="form-control"
                                                        [ngClass]="!initiationForm.controls['casaAccountId'].valid ? 'required-input' : 'valid-input'">
                                                        <option value="" i18n>-- Select Customer Account --</option>
                                                        <option *ngFor="let x of customerAccounts"
                                                            [value]="x.casaAccountId">{{ x.productAccountNumber }}
                                                        </option>
                                                    </select>
                                                </div>

                                                <label for="casaAccountId2"
                                                    class="control-label col-md-2">{{casaAccount2Text}}2</label>
                                                <div class="col-md-4">
                                                    <select (change)="onCustomerAccountChange($event.target.value)"
                                                        name="casaAccountId2" id="casaAccountId2"
                                                        formControlName="casaAccountId2" class="form-control"
                                                        [ngClass]="!initiationForm.controls['casaAccountId2'].valid ? 'required-input' : 'valid-input'">
                                                        <option value="" i18n>-- Select Customer Account --</option>
                                                        <option *ngFor="let x of customerAccounts"
                                                            [value]="x.casaAccountId">{{ x.productAccountNumber }}
                                                        </option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group" *ngIf="loanSelection != null && loanSelection.isLineFacility == true  && loanSelection.isLineMaintained == false" >
                                                <label i18n for="chargeFeeOnce" class="control-label col-md-2"></label>
                                                <div class="col-md-4">
                                                    <label class="checkbox-inline actCheckBox">
                                                <input type="checkbox" [(ngModel)]="chargeFeeOnce" [ngModelOptions]="{standalone: true}"
                                                 name="chargeFeeOnce" id="chargeFeeOnce" value="{{chargeFeeOnce}}"><ng-container i18n>Take fee once</ng-container>
                                                 
                                                 </label>
                                                </div>
                                            </div>
                                            <div class="form-group" *ngIf="(loanSelection.isProjectRelate == true && loanSelection.isLineFacility == false) || (loanSelection.isProjectRelate == true && loanSelection.isLineFacility == true && loanSelection.isLineMaintained == true)"> 
                                                <div class="form-group">
                                                <div class="col-md-4">
                                                    <div class="checkbox-inline actCheckBox">
                                                        <input type="checkbox" formControlName="isProjectRelated" (change)="changed($event)" 
                                                        name="isProjectRelated" id="isProjectRelated">
                                                    </div><label i18n class="checkbox">Project Related</label>
                                                </div>
                                            </div>
                                            </div>
                                            <div class="form-group">
                                                <label i18n for="document" class="control-label col-md-2"></label>
                                                <div class="col-md-4">
                                                    <!-- <button (click)="initiateDrawdown()" class="btn btn-sm btn-primary" [disabled]="(uploadFileTitle==null || file==undefined || initiationForm.invalid || !casaAccountSelected) "><span class="glyphicon glyphicon-book"></span> Initiate DrawDown</button> -->
                                                    <button (click)="initiateDrawdown()" class="btn btn-sm btn-primary"
                                                        [disabled]="( initiationForm.invalid || !casaAccountSelected) "><span
                                                            class="glyphicon glyphicon-book"></span><span i18n>Initiate Drawdown</span></button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                            </div>
                        </p-tabPanel >
                        <p-tabPanel i18n-header  *ngIf="loanSelection != null" header="Loan Request Info">
                            <div class="panel-body">
                                <h5>
                                    <b i18n>Source: </b>{{ loanSource }}
                                </h5>
                                <p-dataTable *ngIf="isMultipleDrawdown" [paginator]="false" resizableColumns="true"
                                    [responsive]="true" [value]="drawdownFacilitiesInformation" selectionMode="single"
                                    (onRowSelect)="pushSelectedLoans($event)"
                                    (onRowUnselect)="popSelectedLoans($event)">
                                    <p-header i18n-header>Multiple Facility Drawdown</p-header>
                                    <!-- <p-column i18n-header [style]="{'width':'38px'}" selectionMode="multiple"></p-column> -->
                                    <p-column i18n-header [style]="{'width':'150px'}" field="productTypeName" header="Facility Type"
                                        sortable="true" [filter]="true" filterMatchMode="contains"></p-column>



                                    <p-column i18n-header [style]="{'width':'150px'}" field="productName" header="Facility Name"
                                        sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                                    <p-column i18n-header field="applicationReferenceNumber" header="Ref No" sortable="true"
                                        [filter]="true" filterMatchMode="contains"></p-column>
                                    <p-column i18n-header [style]="{'width':'150px'}" field="customerName" header="Obligor Name"
                                        sortable="true" [filter]="true" filterMatchMode="contains">
                                        <ng-template pTemplate="body" let-item="rowData">
                                            <span *ngIf="item.loanTypeId == 3">{{item.applicantName}}</span>
                                            <span *ngIf="item.loanTypeId != 3">{{item.customerName}}</span>
                                        </ng-template>
                                    </p-column>
                                    <p-column i18n-header [style]="{'text-align':'right','width':'115px'}" field="approvedAmount"
                                        header="Approved Amount" sortable="true" [filter]="true"
                                        filterMatchMode="contains">
                                        <ng-template pTemplate="body" let-item="rowData">
                                            {{item.approvedAmount | currency:item.currencyCode:true: '1.2-2'}}
                                        </ng-template>
                                    </p-column>
                                    <p-column i18n-header [style]="{'text-align':'right','width':'115px'}" field="amountDisbursed"
                                        header="Disbursed Amount" sortable="true" [filter]="true"
                                        filterMatchMode="contains">
                                        <ng-template pTemplate="body" let-item="rowData">
                                            {{item.amountDisbursed | currency:item.currencyCode:true: '1.2-2'}}
                                        </ng-template>
                                    </p-column>
                                    <p-column i18n-header [style]="{'text-align':'right','width':'115px'}" field="allRequestAmount"
                                        header="Requested Amount" sortable="true" [filter]="true"
                                        filterMatchMode="contains">
                                        <ng-template pTemplate="body" let-item="rowData">
                                            {{item.allRequestAmount | currency:item.currencyCode:true: '1.2-2'}}
                                        </ng-template>
                                    </p-column>
                                    <p-column i18n-header [style]="{'width':'50px'}" field="interestRate" header="Interest"
                                        [filter]="true" filterMatchMode="contains"></p-column>
                                    <p-column i18n-header [style]="{'width':'80px'}" field="approvedTenor" header="Tenor"
                                        sortable="true" [filter]="true" filterMatchMode="contains">
                                        <ng-template pTemplate="body" let-item="rowData">
                                            {{item.approvedTenorString}}
                                        </ng-template>
                                    </p-column>
                                </p-dataTable>
                            </div>
                            <div class="panel-body" style="overflow:scroll; height:300px">
                                <table class="table table-customer-information">
                                    <tbody>
                                        <tr>
                                            <td><strong i18n>Application Reference Number</strong></td>
                                            <td>{{ loanSelection.applicationReferenceNumber }}</td>
                                            <td><strong i18n>Loan Type</strong></td>
                                            <td>{{ loanSelection.loanTypeName }}</td>
                                        </tr>
                                        <tr>
                                            <td><strong i18n>Product Name</strong></td>
                                            <td>{{ loanSelection.productName }}</td>
                                            <td><strong i18n>Product Type</strong></td>
                                            <td>{{ loanSelection.productTypeName}}</td>
                                        </tr>
                                        <tr>
                                            <td><strong i18n>Approved Tenor</strong></td>
                                            <td>{{ loanSelection.approvedTenorString }}</td>
                                            <td><strong i18n>Interest Rate</strong></td>
                                            <td>{{ loanSelection.interestRate }}</td>
                                        </tr>
                                        <tr>
                                            <td><strong i18n>Approved Amount</strong></td>
                                            <td>{{loanSelection.approvedAmount | currency:loanSelection.currencyCode:true: '1.2-2'}}
                                            </td>
                                            <td><strong i18n>Disbursed Amount</strong></td>
                                            <td>{{ loanSelection.amountDisbursed | number: '1.2'}}</td>
                                        </tr>
                                        <tr>
                                            <td><strong i18n>Previous Request</strong></td>
                                            <td>{{ loanSelection.allRequestAmount - loanSelection.requestedAmount | currency:loanSelection.currencyCode:true: '1.2-2' }}
                                            </td>
                                            <td><strong i18n>New Request</strong></td>
                                            <td>{{ loanSelection.requestedAmount | currency:loanSelection.currencyCode:true: '1.2-2'}}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><strong i18n>Unapproved Request</strong></td>
                                            <td>{{ loanSelection.pendingRequestAmount | currency:loanSelection.currencyCode:true: '1.2-2'}}
                                            </td>
                                            <td><strong i18n>Approved Request</strong></td>
                                            <td>{{ loanSelection.approveRequestAmount | currency:loanSelection.currencyCode:true: '1.2-2'}}
                                            </td>
                                        </tr>
                                        <tr>
                                            <td><strong i18n>Total Request</strong></td>
                                            <td>{{ loanSelection.allRequestAmount | currency:loanSelection.currencyCode:true: '1.2-2'}}
                                            </td>
                                            <td><strong i18n>Available Balance</strong></td>
                                            <td>{{ loanSelection.approvedAmount - loanSelection.allRequestAmount | currency:loanSelection.currencyCode:true: '1.2-2'}}
                                            </td>
                                        </tr>

                                    </tbody>
                                </table>
                            </div>
                        </p-tabPanel >
                        <p-tabPanel i18n-header  header="Appraisal Memorandum">
                            <div *ngIf="isMultipleDrawdown" class="panel-body">
                                <p-dataTable [paginator]="false" resizableColumns="true" [responsive]="true"
                                    [value]="drawdownFacilitiesInformation" selectionMode="single"
                                    (onRowSelect)="pushSelectedLoans($event)"
                                    (onRowUnselect)="popSelectedLoans($event)">
                                    <p-header i18n-header>Multiple Facility Drawdown</p-header>
                                    <!-- <p-column i18n-header [style]="{'width':'38px'}" selectionMode="multiple"></p-column> -->
                                    <p-column i18n-header [style]="{'width':'150px'}" field="productTypeName" header="Facility Type"
                                        sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                                    <p-column i18n-header [style]="{'width':'150px'}" field="productName" header="Facility Name"
                                        sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                                    <p-column i18n-header field="applicationReferenceNumber" header="Ref No" sortable="true"
                                        [filter]="true" filterMatchMode="contains"></p-column>
                                    <p-column i18n-header [style]="{'width':'150px'}" field="customerName" header="Obligor Name"
                                        sortable="true" [filter]="true" filterMatchMode="contains">
                                        <ng-template pTemplate="body" let-item="rowData">
                                            <span *ngIf="item.loanTypeId == 3">{{item.applicantName}}</span>
                                            <span *ngIf="item.loanTypeId != 3">{{item.customerName}}</span>
                                        </ng-template>
                                    </p-column>
                                    <p-column i18n-header [style]="{'text-align':'right','width':'115px'}" field="approvedAmount"
                                        header="Approved Amount" sortable="true" [filter]="true"
                                        filterMatchMode="contains">
                                        <ng-template pTemplate="body" let-item="rowData">
                                            {{item.approvedAmount | currency:item.currencyCode:true: '1.2-2'}}
                                        </ng-template>
                                    </p-column>
                                    <p-column i18n-header [style]="{'text-align':'right','width':'115px'}" field="amountDisbursed"
                                        header="Disbursed Amount" sortable="true" [filter]="true"
                                        filterMatchMode="contains">
                                        <ng-template pTemplate="body" let-item="rowData">
                                            {{item.amountDisbursed | currency:item.currencyCode:true: '1.2-2'}}
                                        </ng-template>
                                    </p-column>
                                    <p-column i18n-header [style]="{'text-align':'right','width':'115px'}" field="allRequestAmount"
                                        header="Requested Amount" sortable="true" [filter]="true"
                                        filterMatchMode="contains">
                                        <ng-template pTemplate="body" let-item="rowData">
                                            {{item.allRequestAmount | currency:item.currencyCode:true: '1.2-2'}}
                                        </ng-template>
                                    </p-column>
                                    <p-column i18n-header [style]="{'width':'50px'}" field="interestRate" header="Interest"
                                        [filter]="true" filterMatchMode="contains"></p-column>
                                    <p-column i18n-header [style]="{'width':'80px'}" field="approvedTenor" header="Tenor"
                                        sortable="true" [filter]="true" filterMatchMode="contains">
                                        <ng-template pTemplate="body" let-item="rowData">
                                            {{item.approvedTenorString}}
                                        </ng-template>
                                    </p-column>
                                </p-dataTable>
                            </div>
                            <!-- [disabled]="disableAppraisalMemorandumTab || applicationSelection.productClassProcessId == 2"> -->

                            <!-- cam document -->
                            <div class="card no-padding">
                                <div class="panel panel-default">
                                    <div class="panel-heading">
                                        <div class="row">
                                            <div class="col-md-9">
                                            </div>
                                            <div class="col-md-3">
                                                <div class="pull-right">

                                                    <button (click)="previewDocumentation(true)"
                                                        style="padding: 3px 6px 3px 6px;">
                                                        <span class="glyphicon glyphicon-print"></span> <span i18n>Print</span></button>
                                                </div>
                                            </div>
                                        </div>
                                        <h2 *ngIf="documentations.length > 0" class="panel-title">
                                            FACILITY APPROVAL MEMO No.:
                                            <strong>{{ loanSelection?.applicationReferenceNumber }}</strong> 
                                            <!-- of OBLIGOR:
                                            <strong>{{ loanSelection?.customerName }}</strong> -->
                                        </h2>
                                    </div>


                                    <div class="panel panel-default">

                                        <div class="panel-body" style="overflow:auto;height:400px">
                                            <div *ngFor="let x of documentations">
                                                <p><strong>{{x.title}}</strong></p>
                                                <p><span [innerHtml]="x.templateDocument"></span></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </p-tabPanel >
                        <p-tabPanel i18n-header  header="Offer Letter">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <h2 i18n class="panel-title pull-left">
                                                Generated Offer Letter
                                            </h2>
                                            <!-- <button type="button" (click)="displayReport=false" style="margin-right:5px" class="btn btn-danger pull-right">Cancel</button> -->
                                        </div>
                                    </div>
                                </div>
                                <div class="panel-body">
                                    <iframe [src]="reportSrc" id="report" name="report" frameborder="2" height="500px"
                                        width="750px" style="overflow:auto"></iframe>
                                    <!-- <div class="col-md-12"  style=" width:1000px; overflow:auto;">

                                    </div> -->
                                </div>
                            </div>
                        </p-tabPanel >
                        <p-tabPanel i18n-header  header="Supporting Documents" *ngIf="loanSelection">
                                <!-- <document-upload 
                                [deleteLink]="false"
                                [panelTitle]="CREDITAPPRIASALDOC"
                                [reload]="reload" 
                                [operationId]="loanSelection?.operationId" 
                                [isOperationSpecific]="false"
                                [targetId]="loanSelection?.loanApplicationId" 
                                [targetReferenceNumber]="loanSelection?.applicationReferenceNumber">
                            </document-upload>  -->
                             <document-upload
                                [operationId]="loanSelection?.appraisalOperationId"
                                [customerId]="loanSelection?.customerId"
                                [reload]="reload" 
                                [reloadDocsOnly]="reloadDocs" 
                                [targetId]="loanSelection?.loanApplicationId"
                                [isOperationSpecific]="false"
                                [targetReferenceNumber]="loanSelection?.applicationReferenceNumber"
                                (uploadCount)="setNumberOfUploads($event)">
                            </document-upload> 
                            <!-- <div class="panel panel-default">
                                        <div class="panel-heading">
                                            <h2 class="panel-title">
                                                Supporting Documents
                                            </h2>
                                        </div>
                                        <div *ngIf="isMultipleDrawdown"  class="panel-body">
                                                <p-dataTable [paginator]="false" resizableColumns="true" [responsive]="true" [value]="drawdownFacilitiesInformation" selectionMode="single" (onRowSelect)="pushSelectedLoans($event)" (onRowUnselect)="popSelectedLoans($event)">
                                                        <p-header>Multiple Facility Drawdown</p-header>
                                                        <p-column [style]="{'width':'38px'}" selectionMode="multiple"></p-column>
                                                        <p-column [style]="{'width':'150px'}" field="productTypeName" header="Facility Type" sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                                                        <p-column [style]="{'width':'150px'}" field="productName" header="Facility Name" sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                                                        <p-column i18n-header field="applicationReferenceNumber" header="Ref No" sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                                                        <p-column [style]="{'width':'150px'}" field="customerName" header="Obligor Name" sortable="true" [filter]="true" filterMatchMode="contains">
                                                            <ng-template  pTemplate="body" let-item="rowData" >
                                                                <span *ngIf="item.loanTypeId == 3">{{item.applicantName}}</span>
                                                                <span *ngIf="item.loanTypeId != 3">{{item.customerName}}</span>
                                                            </ng-template>
                                                        </p-column>
                                                        <p-column [style]="{'text-align':'right','width':'115px'}" field="approvedAmount" header="Approved Amount" sortable="true" [filter]="true" filterMatchMode="contains">
                                                            <ng-template pTemplate="body" let-item="rowData">
                                                                {{item.approvedAmount | currency:item.currencyCode:true: '1.2-2'}}
                                                            </ng-template>
                                                        </p-column>
                                                        <p-column [style]="{'text-align':'right','width':'115px'}" field="amountDisbursed" header="Disbursed Amount" sortable="true" [filter]="true" filterMatchMode="contains">
                                                            <ng-template pTemplate="body" let-item="rowData">
                                                                {{item.amountDisbursed | currency:item.currencyCode:true: '1.2-2'}}
                                                            </ng-template>
                                                        </p-column>
                                                        <p-column [style]="{'text-align':'right','width':'115px'}" field="allRequestAmount" header="Requested Amount" sortable="true" [filter]="true" filterMatchMode="contains">
                                                            <ng-template pTemplate="body" let-item="rowData">
                                                                {{item.allRequestAmount | currency:item.currencyCode:true: '1.2-2'}}
                                                            </ng-template>
                                                        </p-column>
                                                        <p-column [style]="{'width':'50px'}" field="interestRate" header="Interest" [filter]="true" filterMatchMode="contains"></p-column>
                                                        <p-column [style]="{'width':'80px'}" field="approvedTenor" header="Tenor" sortable="true" [filter]="true" filterMatchMode="contains">
                                                            <ng-template pTemplate="body" let-item="rowData">
                                                                {{item.approvedTenorString}}
                                                            </ng-template>
                                                        </p-column>
                                                    </p-dataTable>
                                        </div>
                                        <div class="panel-body">
                                            <p-dataTable [value]="supportingDocuments" [paginator]="true" [rows]="5">
                                                <p-column i18n-header field="documentTitle" header="Document Title" sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                                                <p-column i18n-header field="fileExtension" header="Type" [filter]="true" filterMatchMode="contains" [style]="{'width':'60px'}"></p-column>
                                                <p-column i18n-header field="physicalFileNumber" header="File Number" sortable="true" [filter]="true" filterMatchMode="contains" [style]="{'width':'150px'}"></p-column>
                                                <p-column i18n-header field="physicalLocation" header="Physical Location" sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                                                <p-column [style]="{'width':'100px'}">
                                                    <ng-template pTemplate="header"> </ng-template>
                                                    <ng-template pTemplate="body" let-d="rowData" let-i="rowIndex">
                                                        <a *ngIf="['jpg','jpeg', 'png'].indexOf(d.fileExtension.toLowerCase()) > -1" (click)="viewDocument(d.documentId)" href="javascript:void(0)">View</a>
                                                        <a *ngIf="['doc','docx', 'pdf','xls', 'xlsx'].indexOf(d.fileExtension.toLowerCase()) > -1" (click)="DownloadDocument(d.documentId)" href="javascript:void(0)">Download</a>
                                                    </ng-template>
                                                </p-column>
                                            </p-dataTable>

                                        </div>
                                </div> -->
                        </p-tabPanel >

                        <p-tabPanel i18n-header  header="Other Information">
                            <p-accordion #accordion>
                                <p-accordionTab i18n-header header="Customer Information">
                                    <button *ngIf="displayShowCustInfo" type="button" class="btn btn-primary"
                                        (click)="showCustomerInformation()" style="margin-right:5px">
                                        <i class="glyphicon glyphicon-info"></i> <span i18n>Show Customer Information</span></button>
                                    <app-customer-information-detail [loanApplicationId]="loanApplId">
                                    </app-customer-information-detail>
                                </p-accordionTab>
                                <p-accordionTab i18n-header header="Facility Collateral(s)">
                                    <!-- <div class="panel-body coll-list">
                                        <p-dataTable [value]="proposedCollateral" [paginator]="true" [rows]="3">
                                            <p-column i18n-header field="collateralCode" header="Collateral Code" filterMatchMode="contains"></p-column>
                                            <p-column i18n-header field="productName" header="Product Name" 
                                                filterMatchMode="contains">
                                            </p-column>
                                            <p-column i18n-header field="facilityAmount" header="Propose Facility Amount" filterMatchMode="contains">
                                                <ng-template let-d="rowData" let-i="rowIndex" pTemplate="body">
                                                    {{d.facilityCurrencyCode}} {{ d.facilityAmount | number : '1.2' }}
                                                </ng-template>
                                            </p-column>
                                            <p-column i18n-header field="availableCollateralValue" header="Available Collateral Value" filterMatchMode="contains">
                                                <ng-template let-d="rowData" let-i="rowIndex" pTemplate="body">
                                                    {{d.collateralCurrencyCode}} {{ d.availableCollateralValue | number : '1.2' }}
                                                </ng-template>
                                            </p-column>
                                            <p-column i18n-header field="expectedCoveragePercentage" header="Expected Collateral Coverage (%)"  filterMatchMode="contains">
                                                <ng-template let-d="rowData" let-i="rowIndex" pTemplate="body">
                                                    {{ d.expectedCoveragePercentage }} %
                                                </ng-template>
                                            </p-column>
                                            <p-column i18n-header field="expectedCollateralCoverage" header="Expected Coverage" filterMatchMode="contains">
                                                <ng-template let-d="rowData" let-i="rowIndex" pTemplate="body">
                                                    {{d.facilityCurrencyCode}} {{ d.expectedCollateralCoverage | number : '1.2' }}
                                                </ng-template>
                                            </p-column>
                                            <p-column i18n-header field="actualCollateralCoverage" header="Actual Coverage" filterMatchMode="contains">
                                                <ng-template let-d="rowData" let-i="rowIndex" pTemplate="body">
                                                    {{d.facilityCurrencyCode}} {{ d.actualCollateralCoverage | number : '1.2' }}
                                                </ng-template>
                                            </p-column>
                                            <p-column i18n-header field="actualCoveragePercentage" header="Actual Collateral Coverage (%)"  filterMatchMode="contains">
                                                <ng-template let-d="rowData" let-i="rowIndex" pTemplate="body">
                                                    {{ d.actualCoveragePercentage }} %
                                                </ng-template>
                                            </p-column>
                                            <p-column i18n-header field="totalCoverage" header="Total Facility Coverage Achieved (%)"  filterMatchMode="contains">
                                                <ng-template let-d="rowData" let-i="rowIndex" pTemplate="body">
                                                    {{ d.totalCoverage }} %
                                                </ng-template>
                                            </p-column>
                                            
                                        </p-dataTable>
                                    </div> -->
                                    <app-collaterals-proposed [loanApplicationId]="loanSelection?.loanApplicationId"
                                        [currencyId]="loanSelection?.currencyId"
                                        [reload]="loanSelection?.loanApplicationId">
                                    </app-collaterals-proposed>
                                    <!-- <div class="panel-body">
                                        <p-dataTable *ngIf="loanSelection != null" id="loanCollateralList"
                                            [value]="loanSelection.loanCollateral" [responsive]="true"
                                            [paginator]="false" [rows]="5">
                                            <p-column *ngIf="isGroup" field="customerName" header="Customer Name"
                                                sortable="true" filterMatchMode="contains"></p-column>
                                            <p-column i18n-header field="collateralTypeName" header="Type"
                                                [style]="{'width':'280px'}" sortable="true" filterMatchMode="contains">
                                            </p-column>
                                            <p-column i18n-header field="currencyCode" header=""
                                                [style]="{'text-align':'right','width':'40px'}" sortable="true"
                                                filterMatchMode="contains"></p-column>
                                            <p-column i18n-header field="collateralValue" header="Value" sortable="true"
                                                filterMatchMode="contains">
                                                <ng-template pTemplate="body" let-item="rowData">
                                                    {{item.collateralValue | number:'1.2'}}
                                                </ng-template>
                                            </p-column>
                                            <p-column i18n-header field="haircut" header="Haircut" sortable="true"
                                                filterMatchMode="contains"></p-column>
                                            <p-column i18n-header field="valuationCycle" header="Valuation Cycle" sortable="true"
                                                filterMatchMode="contains"></p-column>
                                            <p-column [style]="{'width':'40px'}">
                                                <ng-template pTemplate="header"></ng-template>
                                                <ng-template let-d="rowData" let-i="rowIndex" pTemplate="body">
                                                    <a (click)="ViewCollateralDetails(d)"
                                                        href="javascript:void(0)">View</a>
                                                </ng-template>
                                            </p-column>
                                        </p-dataTable>
                                    </div> -->
                                </p-accordionTab>
                                <p-accordionTab i18n-header header="Loan Job Requests">
                                    <div *ngIf="loanSelection != null && loanSelection != undefined" class="panel-body"
                                        style="overflow:auto;height:250px">
                                        <job-request-view [loanApplicationId]=loanApplId
                                            [loanApplicationDetailId]=loanApplDetailId
                                            [operationId]=loanSelection.operationId [showTitle]=false>
                                        </job-request-view>
                                    </div>
                                </p-accordionTab>
                            </p-accordion>
                        </p-tabPanel >

                        <!-- <p-tabPanel i18n-header  header="Drawdown Memo">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <h2 class="panel-title pull-left">
                                                Drawdown Memo
                                            </h2>
                                                <button  (click)="printDrawdownMemo()" style="margin-left:25px" >Generate Drawdown Memo</button>
                                        </div>
                                    </div>
                                </div>
                                <div id='print-drawdon-section' class="panel-body" [innerHtml]="drawdownHtml"></div>
                            </div>

                        </p-tabPanel > -->

                        <p-tabPanel i18n-header  header="Lien Placement">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <h2 i18n class="panel-title pull-left">
                                                Cash Collateral Lien Placement
                                            </h2>
                                            <!-- <button type="button" (click)="displayReport=false" style="margin-right:5px" class="btn btn-danger pull-right">Cancel</button> -->
                                        </div>
                                    </div>
                                </div>
                                <div class="panel-body">
                                    <app-lien-on-investment *ngIf="loanSelection"
                                        [loanApplicationId]="loanSelection.loanApplicationId"
                                        [applicationDetailId]="loanSelection.loanApplicationDetailId"
                                        [currencyId]="loanSelection.currencyId"
                                        [reload]="loanSelection.loanApplicationId"
                                        [isUserLegal]="isUserLegal"
                                        (allLiensArePlaced)=lienIsSatisfied($event)>
                                    </app-lien-on-investment>
                                </div>
                            </div>
                        </p-tabPanel >
                        <p-tabPanel i18n-header  header="Approval Comments">
                            <div class="panel panel-default" *ngIf="loanSelection">
                                    <app-approval-comments [all]="true" [tableLabel]="'Approval Process Comments'" [operationId]="loanSelection?.appraisalOperationId" [applicationId]="loanSelection?.loanApplicationId"></app-approval-comments>
                           
                                <!-- <app-approval-comments [operationId]="loanSelection.appraisalOperationId"
                                    [applicationId]="loanSelection.loanApplicationId" [tableLabel]="commentTitle">
                                </app-approval-comments>
                                <app-approval-comments [operationId]="loanSelection.operationId"
                                    [applicationId]="loanSelection.loanBookingRequestId" [tableLabel]="commentTitle2">
                                </app-approval-comments> -->
                            </div>
                        </p-tabPanel >

                        <p-tabPanel i18n-header  *ngIf="loanSelection?.appraisalOperationId == 202 || loanSelection?.appraisalOperationId == 146" header="Approval Memo">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <h2 i18n class="panel-title pull-left">
                                                Approval Memo
                                            </h2>
                                            <button i18n *ngIf="userIsAccountOfficer" type="button" (click)="editCashBack()"
                                                [disabled]="!initiationForm.invalid"
                                                class="btn btn-success pull-right">Edit Memo</button>
                                        </div>
                                    </div>
                                </div>
                                <div *ngIf="cashBackHtml != null" class="panel-body" style="min-height:450px;">
                                    <app-ckeditior-project [content]="cashBackHtml" [height]="400"
                                        (contentChange)="contentChange($event)"></app-ckeditior-project>
                                </div>

                            </div>

                        </p-tabPanel >
                        <p-tabPanel i18n-header  header="Project Risk Rating" *ngIf="(loanSelection != null && projectRiskRatingss.length > 0)">
                            <div class="panel panel-default">
        
                                <div class="panel-heading">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <h2 i18n class="panel-title pull-left">
                                                Project Risk Rating
                                            </h2>
                                            <div class="pull-right">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            
                                <div class="panel-body">
                            
                                     <table class="table table-bordered table-hover">
                            
                                            <tr>
                                                <th>SN</th>
                                                <th>Criteria</th>
                                                <th>Value</th>
                                            </tr>
                                            <tbody>
                            
                                                <tr *ngFor="let field of projectRiskRatingComputation; let i = index;">
                                                    <td>{{i + 1}}</td>
                                                    <td>{{field.categoryName}}</td>
                                                    <td>{{field.categoryValue}}</td>
                                                </tr>
                                                <tr>
                                                    <td colspan="2"><strong i18n>OBLIGOR/ CONTRACTOR
                                                    </strong></td>
                                                    <td><strong>{{rating}}</strong></td>                                        
                                                </tr>
                                                <tr>
                                                    <td colspan="2"><strong i18n>Rating
                                                    </strong></td>
                                                    <td><strong>{{computation}}</strong></td>                                        
                                                </tr>
                                                <tr>
                                                    <td colspan="2"><strong i18n>Risk Categorisation
                                                    </strong></td>
                                                    <td><strong>{{riskCategorisation}}</strong></td>                                        
                                                </tr>
                                                <tr>
                                                    <td colspan="2"><strong i18n>Project Location
                                                    </strong></td>
                                                    <td><strong>{{projectLocation}}</strong></td>                                        
                                                </tr>
                                                <tr>
                                                    <td colspan="2"><strong i18n>Project Details
                                                    </strong></td>
                                                    <td><strong>{{projectDetails}}</strong></td>                                        
                                                </tr>
                                            </tbody>
                                        </table>
                                        <div class="panel-footer">
                                            <div class="row">
                                                <div class="col-md-12">
                                                </div>
                                            </div>
                                        </div>
                                </div>
                            </div>
                        </p-tabPanel > 

                    </p-tabView>
                </form>
                <div class="panel-footer">
                    <div class="row">
                        <div class="col-md-12">
                            <button type="button" style="margin-left:5px" (click)="offerLetterChecklist()"
                                class="btn btn-success pull-left">
                                <i class="glyphicon glyphicon-ok"></i> <span i18n>Deferral Waivers</span></button>
                            <!-- <button type="button" (click)="initiateBooking(initiationForm)" [disabled]="!initiationForm.invalid" class="btn btn-success pull-right">Initiate Booking</button> -->
                            <button i18n type="button" (click)="closeDialog()" style="margin-right:5px"
                                class="btn btn-danger pull-right">Cancel</button>
                        </div>
                    </div>
                </div>
            </div>

            <p-dialog [responsive]=true [(visible)]="showCasgBackForm" id="add-modal" modal="modal" showEffect="fade"
                width="1200">
                <div style="margin-bottom:0" class="panel panel-default">
                    <div class="panel-heading">
                        <h2 i18n class="panel-title">
                            CASHBACK
                        </h2>
                    </div>

                    <form novalidate [formGroup]="cashBackForm" autocomplete="off">
                        <div class="panel-body">
                            <div class="form-horizontal">
                                <div class="form-group">
                                    <label i18n for="" class="control-label col-md-2">Background</label>
                                    <div class="col-md-4 pull-left">
                                        <input type="text" formControlName="background"
                                            [ngClass]="!cashBackForm.controls['background'].valid ? 'required-input' : 'valid-input'"
                                            name="background" class="form-control">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label i18n for="" class="control-label col-md-2">Issues</label>
                                    <div class="col-md-4 pull-left">
                                        <input type="text" formControlName="issues"
                                            [ngClass]="!cashBackForm.controls['issues'].valid ? 'required-input' : 'valid-input'"
                                            name="issues" class="form-control">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label i18n for="" class="control-label col-md-2">Request</label>
                                    <div class="col-md-4 pull-left">
                                        <input type="text" formControlName="request"
                                            [ngClass]="!cashBackForm.controls['request'].valid ? 'required-input' : 'valid-input'"
                                            name="request" class="form-control">
                                    </div>
                                </div>

                            </div>
                        </div>

                        <div class="panel-footer">
                            <div class="row">
                                <div class="col-md-12">
                                    <button i18n type="button" (click)="submitCashbackForm(cashBackForm)"
                                        [disabled]="cashBackForm.invalid"
                                        class="btn btn-success pull-right">Save</button>
                                    <button i18n type="button" (click)="showCasgBackForm=false" style="margin-right:5px"
                                        class="btn btn-danger pull-right">Cancel</button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </p-dialog>

            <div *ngIf="displayInitiationForm && loanSelection != null && loanSelection != 'undefined'">
                <risk-acceptance-criteria [racCategoryTypeId]="racCategoryTypeId" [isDrawdown]="true"
                    [racSearchBaseId]="racSearchBaseId" [racOperationId]="loanSelection?.operationId"
                    [customerId]="loanSelection?.customerId" [racCurrencyId]="racCurrencyId"
                    [loanApplicationId]="loanSelection?.loanApplicationId" [operationId]="loanSelection?.operationId"
                    [racProductClassId]="racProductClassId" [searchBasePlaceholder]="searchBasePlaceholder"
                    [productId]="loanSelection?.productId" [reload]="loanSelection?.productId"
                    [getFormOutput]="submitEvent" (formOutput)="setRacValues($event)">
                </risk-acceptance-criteria>
            </div>
        </div>

        <div class="panel-footer">
            <div class="row">
                <div class="col-md-12">
                </div>
            </div>
        </div>

        <!--end of card1-->
    </div>
</div>

<fintrakbanking-message [title]="title" [message]="message" [show]="show" [cssClass]="cssClass"
    (closeEvent)="hideMessage($event)">
</fintrakbanking-message>

<!--modal for obligor / Loan details starts-->

<p-dialog [responsive]=true [(visible)]="displayDocument" modal="modal" showEffect="fade" width="1200">
    <div *ngIf="displayDocument" style="margin-bottom:0" class="panel panel-default">

        <div class="panel-heading">
            <h2 class="panel-title">
                <ng-container i18n>Document Title:</ng-container>
                <strong>{{ selectedDocument }}</strong>
            </h2>
            <div class="pull-right"><a class="close" (click)="displayDocument=false">&times;</a></div>
        </div>

        <div class="panel-body" style="overflow:auto;height:450px">

            <img *ngIf="binaryFile" style="max-width: 100%; display: block 2px black;"
                [src]="'data:image/jpg;base64,'+binaryFile" alt="" class="img-thumbnail">
        </div>
    </div>
</p-dialog>



<!-- <app-condition-checklist [isLMSChecklist]="false" [showOrHideList]='false'></app-condition-checklist> -->
<!-- <p-dialog [responsive]=true [(visible)]="showCollateralInformation" id="charge-modal" modal="modal" width="1000"> -->
<!-- <collateral-information-view [reload]="reload" [jobReply]="false"
    [showCollateralInformation]="showCollateralInformation" (closeWindow)="closeCollateralDetaits($event)"
    [collateralCustomerId]="collateralCustomerId">
</collateral-information-view> -->
<!-- </p-dialog> -->

<app-condition-checklist *ngIf="loanSelection != null" 
    [isLMSChecklist]="false" [showOrHideList]="false"
    [operationId]="loanSelection.operationId" 
    [customerId]="loanSelection.customerId"
    [loanReviewApplicationId]="offerLetterChecklistIndex"
    (resetofferLetterChecklist)="resetofferLetterChecklist($event)"
    (refreshProvidedDocuments)="refreshDoc($event)"
    [applicationRefNumber]="loanSelection.applicationReferenceNumber" 
    [loanApplicationId]="loanSelection.loanApplicationId">
</app-condition-checklist>

<!-- <p-dialog [responsive]=true [(visible)]="showCollateralInformation" id="charge-modal" modal="modal" width="1000"> 
<collateral-information-view [reload]="reload" [jobReply]="false"
    [showCollateralInformation]="showCollateralInformation" (closeWindow)="closeCollateralDetaits($event)"
    [collateralCustomerId]="collateralCustomerId">
</collateral-information-view> 
</p-dialog> -->



<p-dialog [responsive]=true [(visible)]="displayReport" width="1200" modal="modal" showEffect="fade">
    <div class="panel panel-default">
        <div class="panel-heading">
            <div class="row">
                <div class="col-md-12">
                    <h2 i18n class="panel-title pull-left">
                        Drawdown Memo
                    </h2>
                    <button i18n type="button" (click)="displayReport=false" style="margin-right:5px"
                        class="btn btn-danger pull-right">Cancel</button>


                </div>
            </div>
        </div>
        <div class="panel-body">

            <div class="col-md-12" *ngIf="displayTestReport" style=" width:1200px; overflow:auto;">
                <iframe [src]="reportSrc" id="report" name="report" frameborder="2" height="500px" width="1200px"
                    style="overflow:auto"></iframe>
            </div>
        </div>
    </div>
    <div class="panel-footer">
        <div class="row">
            <div class="col-md-12">
                <button i18n type="button" (click)="displayReport=false" style="margin-right:5px"
                    class="btn btn-danger pull-right">Cancel</button>
            </div>
        </div>
    </div>
</p-dialog>

<p-dialog [responsive]=true [(visible)]="displayMemberSearchForm" modal="modal" id="searchModal" showEffect="fade"
    width="650" [contentStyle]="{'overflow':'auto','max-height':'700px'}">
    <div style="margin-bottom:0" class="panel panel-default">
        <div class="panel-heading">
            <div style="margin-left:0" class="row">
                <h2 i18n class="panel-title pull-left">
                    Search Member
                </h2>
                <div class="pull-right">
                    <a class="close" style="margin: -10px 8px;" (click)="displayMemberSearchForm=false">&times;</a>
                </div>
            </div>
        </div>
        <div style="padding:3px" class="panel-body">
            <div class="form-group">
                <div class="col-md-12">
                    <input type="text" id="search" #approvalInPut (keyup)="searchApprover($event.target.value)"
                        class="form-control"  i18n-placeholder placeholder="Type in the member name...">
                </div>
            </div>

            <div class="form-group">
                <div class="col-md-12">
                    <p>
                        <!--{{mfacilityType}}-->
                    </p>
                    <table *ngIf="groupMembers" class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Customer Code</th>
                                <th>First Name</th>
                                <th>Middle Name</th>
                                <th>Last Name</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr (click)="pickSearchedApprover(res)" style="cursor: pointer"
                                *ngFor="let res of groupMembers; let i = index">
                                <td>{{res.customerCode}}</td>
                                <td>{{res.firstName}}</td>
                                <td>{{res.secondName}}</td>
                                <td>{{res.lastName}}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</p-dialog>

<p-dialog [responsive]=true [(visible)]="displayApproverSearchForm" modal="modal" id="searchModal" showEffect="fade"
    width="650" [contentStyle]="{'overflow':'auto','max-height':'700px'}">
    <div style="margin-bottom:0" class="panel panel-default">
        <div class="panel-heading">
            <div style="margin-left:0" class="row">
                <h2 i18n class="panel-title pull-left">
                    Search Staff
                </h2>
                <div class="pull-right">
                    <a class="close" style="margin: -10px 8px;" (click)="displayApproverSearchForm=false">&times;</a>
                </div>
            </div>
        </div>
        <div style="padding:3px" class="panel-body">
            <div class="form-group">
                <div class="col-md-12">
                    <input type="text" id="staffSearch" #staffInPut (keyup)="searchApprover($event.target.value)"
                        class="form-control"  i18n-placeholder placeholder="Type in the staff name...">
                </div>
            </div>

            <div class="form-group">
                <div class="col-md-12">
                    <p>
                        <!--{{mfacilityType}}-->
                    </p>
                    <table *ngIf="availableApprovers" class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Staff Code</th>
                                <th>First Name</th>
                                <th>Middle Name</th>
                                <th>Last Name</th>
                                <th>Staff Role</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr (click)="pickSearchedApprover(res)" style="cursor: pointer"
                                *ngFor="let res of availableApprovers; let i = index">
                                <td>{{res.staffCode}}</td>
                                <td>{{res.firstName}}</td>
                                <td>{{res.secondName}}</td>
                                <td>{{res.lastName}}</td>
                                <td>{{res.staffRoleName}}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</p-dialog>

<p-dialog [responsive]=true [(visible)]="displayCustomerSearchForm" modal="modal" id="searchModal" showEffect="fade"
    width="650" [contentStyle]="{'overflow':'auto','max-height':'700px'}">
    <div style="margin-bottom:0" class="panel panel-default">
        <div class="panel-heading">
            <div style="margin-left:0" class="row">
                <h2 i18n class="panel-title pull-left">
                    Search Customer
                </h2>
                <div class="pull-right">
                    <a class="close" style="margin: -10px 8px;" (click)="displayCustomerSearchForm=false">&times;</a>
                </div>
            </div>
        </div>
        <div style="padding:3px" class="panel-body">
            <div class="form-group">
                <div class="col-md-12">
                    <input type="text" id="search" #customerInPut (keyup)="searchApprover($event.target.value)"
                        class="form-control"  i18n-placeholder placeholder="Type in the customer name...">
                </div>
            </div>

            <div class="form-group">
                <div class="col-md-12">
                    <p>
                        <!--{{mfacilityType}}-->
                    </p>
                    <table *ngIf="customers" class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Customer Code</th>
                                <th>Customer Name</th>
                                <th>Customer Type</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr (click)="pickSearchedApprover(res)" style="cursor: pointer"
                                *ngFor="let res of customers; let i = index">
                                <td>{{res.customerCode}}</td>
                                <td>{{res.customerName}}</td>
                                <td>{{res.customerTypeName}}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</p-dialog>

<!-- =================================== contracror criteria ======================== -->
<p-dialog [responsive]="true" [(visible)]="displayProjectRiskRatingModal" id="limit-def-modal" modal="modal" showEffect="fade"
    width="1000">
   
    <div class="panel panel-default" *ngIf="projectRiskRatings != null && projectRiskRatings != undefined && projectRiskRatings != {}">

        <div *ngIf="projectRiskRatings != null" class="panel-heading">
            <div class="row">
                <div class="col-md-12">
                    <h2 i18n class="panel-title pull-left">
                        Project Risk Rating
                    </h2>
                    <div class="pull-right">
                    </div>
                </div>
            </div>
        </div>
    
        <div class="panel-body">
    
            <form  *ngIf="projectRiskRatings != null && projectRiskRatings != undefined && projectRiskRatings != {}" [formGroup]="projectRiskRatingForm" class="form-horizontal" autocomplete="off">
                <table class="table table-bordered table-hover">
    
                    <tr>
                        <th>SN</th>
                        <th>Required</th>
                        <th>Value</th>
                    </tr>
                    <tbody>
    
                        <tr *ngFor="let field of projectRiskRatings; let i = index;">
                            <td>{{i + 1}}</td>
                            <td>{{field.categoryName}}</td>
                            <td>
                                <div class="form-group row" style="margin:0px">
                                    <div>
                                        <select class="form-control" id={{field.categoryId}} name={{field.categoryId}}
                                        formControlName={{field.categoryId}}
                                        [ngClass]="projectRiskRatingForm.controls[field.categoryId].valid ? 'valid-input' : 'required-input'">
                                        <option value="" i18n>-- Select --</option>
                                        <option *ngFor=" let x of field.criterias" [value]="x.criteriaValue">{{x.criteria}}</option>
                                    </select>
                                    </div>
                                </div>
                            </td>
                        </tr>
    
                    </tbody>
                </table>
                <div class="form-group">
                    <label i18n for="projectLocation" class="col-md-2 control-label">Project Location
                    </label>
                    <div class="col-md-4">
                        <input type="text" name="projectLocation" formControlName="projectLocation"
                        id="projectLocation" class="form-control" 
                        [ngClass]="projectRiskRatingForm.controls['projectLocation'].valid ? 'valid-input' : 'required-input'">
                    </div>
                </div>
                <div class="form-group">
                    <label i18n for="projectDetails" class="col-md-2 control-label">Project Details
                    </label>
                    <div class="col-md-4">
                        <textarea type="text" name="projectDetails" formControlName="projectDetails"
                        id="projectDetails" class="form-control" 
                        [ngClass]="projectRiskRatingForm.controls['projectDetails'].valid ? 'valid-input' : 'required-input'"></textarea>
                    </div>
                </div>
                <div class="panel-footer">
                    <div class="row">
                        <div class="col-md-12">
                            <button i18n type="button" (click)="submitProjectRiskRatingForm(projectRiskRatingForm)"
                                [disabled]="projectRiskRatingForm.invalid" class="btn btn-success pull-right">Save</button>
                            <button i18n type="button" (click)="displayProjectRiskRatingModal=false" style="margin-right:5px"
                                class="btn btn-danger pull-right">Cancel</button>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
    
</p-dialog>

<!-- <p-dialog [responsive]=true [(visible)]="displayReport" width="800" modal="modal" showEffect="fade">

        <div class="panel-footer">
            <div class="row">
                <div class="col-md-12">
                    <button type="button" (click)="displayReport=false" style="margin-right:5px" class="btn btn-danger pull-right">Cancel</button>
                </div>
            </div>
        </div>
    </p-dialog> -->