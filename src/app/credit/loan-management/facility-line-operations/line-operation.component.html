<div class="ui-g">
    <div class="ui-g-12 no-padding">
        <div class="card no-padding">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-md-12">
                            <h2 i18n  class="panel-title pull-left">
                                Facility Line Review Operations
                            </h2>
                            <div *ngIf="displayCustomerLoanDetails" class="pull-right">
                                <button i18n  pButton type="button" (click)="showLoanReviewForm()" label="Perform Operation" icon="fa-plus"></button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="panel-body">
                    <div *ngIf="displayLoanReviewList" class="form-horizontal">
                        <div class="form-group">
                            <div class="col-md-4">

                            </div>
                        </div>
                        <div class="card no-padding">
                            <p-dataTable [paginator]="true" [value]="approvedLineReviewData" [rows]="15" (onRowSelect)="onSelectedLoanReviewChange($event)">
                                <p-column i18n-header  [style]="{'width':'38px'}" selectionMode="single"></p-column>
                                <p-column i18n-header  field="loanTypeId" header="Type" [style]="{'width':'43px'}" filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        <span *ngIf="item.loanTypeId == 1">Single</span>
                                        <span *ngIf="item.loanTypeId != 1">Group</span>
                                    </ng-template>
                                </p-column>
                                <p-column i18n-header  [style]="{'width':'80px'}" field="lmsApplicationReferenceNumber" header="Reference" sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                                <p-column i18n-header  field="applicantName" [style]="{'width':'150px'}" header="Obligor's Name" sortable="true" [filter]="true" filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        <span *ngIf="item.loanTypeId == 1">{{item.customerName}}</span>
                                        <span *ngIf="item.loanTypeId != 1">{{item.customerName}} ({{item.customerGroupName}})</span>
                                    </ng-template>
                                </p-column>
                                <p-column i18n-header  [style]="{'width':'100px'}" field="operationName" header="Operation" sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                                <p-column i18n-header  [style]="{'width':'70px'}" field="divisionShortCode" header="Unit" [filter]="true" filterMatchMode="contains"></p-column>
                                <p-column i18n-header  [style]="{'width':'100px'}" field="productTypeName" header="Facility Type" sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                                <p-column i18n-header  [style]="{'text-align':'right','width':'115px'}" field="approvedAmount" header="Approved Amount" sortable="true" [filter]="true" filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        {{item.approvedAmount | currency:item.currencyCode:true: '1.2-2'}}
                                    </ng-template>
                                </p-column>
                                <p-column i18n-header  [style]="{'text-align':'right','width':'115px'}" field="allRequestAmount" header="Requested Amount" sortable="true" [filter]="true" filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        {{item.allRequestAmount | currency:item.currencyCode:true: '1.2-2'}}
                                    </ng-template>
                                </p-column>
                                <p-column i18n-header  [style]="{'text-align':'right','width':'115px'}" field="amountDisbursed" header="Disbursed Amount" sortable="true" [filter]="true" filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        {{item.amountDisbursed | currency:item.currencyCode:true: '1.2-2'}}
                                    </ng-template>
                                </p-column>
                                <p-column i18n-header  [style]="{'width':'40px'}" field="interestRate" header="Interest" [filter]="true" filterMatchMode="contains"></p-column>
                                <p-column i18n-header  [style]="{'width':'80px'}" field="approvedTenor" header="Tenor" sortable="true" [filter]="true" filterMatchMode="contains">
                                    <ng-template pTemplate="body" let-item="rowData">
                                        {{item.approvedTenorString}}
                                    </ng-template>
                                </p-column>
                                <p-column i18n-header [style]="{'width':'70px'}" field="approvalStatusName" header="Approval Status " sortable="false" [filter]="false" filterMatchMode="contains">
                                    <ng-template let-col let-ln="rowData" pTemplate="body">
                                        <span class="label label-info"> {{ln[col.field] | uppercase }}</span>
                                    </ng-template>
                                </p-column>
                            </p-dataTable>
                        </div>
                    </div>

                    <div *ngIf="displayCustomerLoanDetails" class="form-horizontal">
                        <div class="form-group">
                            <p-tabView>
                                <p-tabPanel i18n-header  header="Facility Details">
                                    <div style="margin-bottom:0" class="panel panel-default">
                                        <div class="panel-heading">
                                            <h2 i18n  class="panel-title">
                                                Facility Line Details
                                            </h2>
                                        </div>
                                        <div class="panel-body">
                                            <table *ngIf="selectedLoanReview != null" class="table table-customer-information">
                                                <tbody>

                                                    <tr>
                                                        <td>
                                                            <strong i18n>Application Reference No:</strong>
                                                        </td>
                                                        <td>{{ selectedLoanReview.applicationReferenceNumber ? selectedLoanReview.applicationReferenceNumber : 'N/A'}}</td>
                                                        <td>
                                                            <strong i18n>Customer Code</strong>
                                                        </td>
                                                        <td>{{ selectedLoanReview.customerCode }}</td>
                                                        <td>
                                                            <strong i18n>Customer Group</strong>
                                                        </td>
                                                        <td>{{ selectedLoanReview.customerGroupName ? selectedLoanReview.customerGroupName : 'N/A'}}</td>

                                                    </tr>
                                                    <tr>
                                                        <td>
                                                            <strong i18n>Customer Name</strong>
                                                        </td>
                                                        <td>{{ selectedLoanReview.customerName ? selectedLoanReview.customerName : 'N/A'}}</td>
                                                        <td>
                                                            <strong i18n> Sector Name</strong>
                                                        </td>
                                                        <td>{{ selectedLoanReview.sectorName }}</td>
                                                        <td>
                                                            <strong i18n> Sub-Sector Name</strong>
                                                        </td>
                                                        <td>{{ selectedLoanReview.subSectorName }}</td>
                                                    </tr>
                                                    <tr>
                                                        <td>
                                                            <strong i18n>Initiating Officer</strong>
                                                        </td>
                                                        <td>{{ selectedLoanReview.relationshipOfficerName ? selectedLoanReview.relationshipOfficerName : 'N/A' }}</td>
                                                        <!-- <td>
                                                            <strong i18n>Business Manager</strong>
                                                        </td>
                                                        <td>{{ selectedLoanReview.relationshipManagerName }}</td> -->
                                                        <td>
                                                            <strong i18n>Branch Name</strong>
                                                        </td>
                                                        <td>{{ selectedLoanReview.branchName }}</td>
                                                    </tr>
                                                    <tr>
                                                        <td>
                                                            <strong i18n> Facility</strong>
                                                        </td>
                                                        <td>{{ selectedLoanReview.productName }}</td>
                                                        <td>
                                                            <strong i18n>Facility Type</strong>
                                                        </td>
                                                        <td>{{ selectedLoanReview.productTypeName ? selectedLoanReview.productTypeName : 'N/A'}}</td>
                                                        <td>
                                                            <strong i18n>Customer Type</strong>
                                                        </td>
                                                        <td>{{ selectedLoanReview.customerType ? selectedLoanReview.customerType : 'N/A'}}</td>
                                                    </tr>
                                                    <tr>
                                                        <td>
                                                            <strong i18n>Approved Limit</strong>
                                                        </td>
                                                        <td>{{ selectedLoanReview.approvedAmount | currency:selectedLoanReview.currencyCode:true:'1.2-2'}}</td>
                                                        <td>
                                                            <strong i18n> Interest Rate</strong>
                                                        </td>
                                                        <td>{{ selectedLoanReview.interestRate }}</td>
                                                        <td>
                                                            <strong i18n>Line Tenor</strong>
                                                        </td>
                                                        <td>{{ selectedLoanReview.approvedTenorString }}</td>
                                                    </tr>
                                                    <tr>
                                                        <td>
                                                            <strong i18n> Effective Date</strong>
                                                        </td>
                                                        <td>{{ selectedLoanReview.effectiveDate ? (selectedLoanReview.effectiveDate | date) : 'N/A'}}</td>
                                                        <td>
                                                            <strong i18n> Expiry Date </strong>
                                                        </td>
                                                        <td>{{ selectedLoanReview.expiryDate ? (selectedLoanReview.expiryDate | date) : 'N/A' }}</td>
                                                        <td>
                                                            <strong> </strong>
                                                        </td>
                                                        <td></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        <div class="form-group">
                                            <label i18n  class="col-md-2">Take Fee?</label>

                                            <div class="col-md-4">
                                                <select name="takeFeeStatus" [(ngModel)]="takeFeeStatus" class="form-control" [ngClass]="!takeFeeStatus ? 'required-input' : 'valid-input'">
                                                        <option i18n  value="">--- Select Status ---</option>
                                                        <option i18n  value="1"> Take Fee </option>
                                                        <option i18n  value="2"> Do Not Take Fee </option>
                        
                                                    </select>
                                            </div>
                                        </div>
                                        <form *ngIf="displayTenorChangeModal" [formGroup]="tenorChangeForm" autocomplete="off">
                                            <div class="panel-body">
                                                <fieldset style="padding-left:14px">
                                                    <legend><strong i18n>Tenor Change</strong></legend>
                                                    <div class="form-group">
                                                        <label i18n  for="newTenor" class="control-label col-md-2">Add Tenor (days)</label>
                                                        <div class="col-md-2 ">
                                                            <input type="text" name="newTenor" formControlName="newTenor" id="tempTenor" class="form-control" [ngClass]="!tenorChangeForm.controls['newTenor'].valid ? 'required-input' : 'valid-input'">
                                                        </div>
                                                        <div class="col-md-2 ">
                                                            <button  (click)="calculateNewTenor(tenorChangeForm)" class="btn btn-sm btn-primary"><span class="glyphicon glyphicon-plus"></span>
                                                            <ng-container i18n> Add Tenor</ng-container>
                                                            
                                                            </button>
                                                        </div>
                                                        <label *ngIf="data.operationTypeId != 266" i18n  for="newMaturity" class="control-label col-md-2">New Expiry Date</label>
                                                        <div  *ngIf="data.operationTypeId != 266" class="col-md-4 ">
                                                            <input type="text" [attr.disabled]="true" name="newMaturity" formControlName="newMaturity" id="newMaturity" class="form-control" [ngClass]="!tenorChangeForm.controls['newMaturity'].valid ? 'required-input' : 'valid-input'">
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label i18n  for="newTenorLeft" class="control-label col-md-2">New Tenor Left (days)</label>
                                                        <div class="col-md-4 ">
                                                            <input type="text" [attr.disabled]="true" name="newTenorLeft" value="{{newTenorLeft}}" id="tempTenor" class="form-control">
                                                        </div>

                                                        <label i18n  for="totalTenor" class="control-label col-md-2">Total Tenor (days)</label>
                                                        <div class="col-md-4 ">
                                                            <input type="text" [attr.disabled]="true" name="totalTenor" value="{{totalTenor}}" id="totalTenor" class="form-control">
                                                        </div>
                                                    </div>
                                                </fieldset>
                                                <div class="form-group">
                                                    <div class="col-md-4">
                                                        <button i18n  type="button" (click)="addTenor(tenorChangeForm)" [disabled]="!tenorChangeForm.valid && !hasNewMaturityDate || !takeFeeStatus" class="btn btn-success ">Submit</button>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                        <form *ngIf="displayInterestChangeModal" [formGroup]="interestRateChangeForm" autocomplete="off">
                                            <div class="panel-body">
                                                <fieldset style="padding-left:14px">
                                                    <legend><strong i18n>Interest Rate Change</strong></legend>
                                                    <div class="form-group">
                                                        <label i18n  for="New Interest Rate" class="control-label col-md-2">New Interest Rate</label>
                                                        <div class="col-md-4 ">
                                                            <input type="text" name="newInterestRate" formControlName="newInterestRate" id="newInterestRate" class="form-control" [ngClass]="!interestRateChangeForm.controls['newInterestRate'].valid ? 'required-input' : 'valid-input'">
                                                        </div>
                                                        <label i18n  for="Value Date" class="control-label col-md-2">Value Date</label>
                                                        <div class="col-md-4 ">
                                                            <!-- <p-calendar id="valueDate" 
                                                            formControlName="valueDate" 
                                                            dateFormat="dd/mm/yy" [responsive]="true" 
                                                            [ngClass]="!interestRateChangeForm.controls['valueDate'].valid ? 'required-input' : 'valid-input'"
                                                                [inputStyle]="{'width': '100%' }" [style]="{'width': '100%', 'overflow': 'visible'  }" [monthNavigator]="true" [yearNavigator]="true" yearRange="1955:2030" [showIcon]="true"></p-calendar> -->
                                                            <p-calendar id="valueDate" formControlName="valueDate" dateFormat="dd/mm/yy" [ngClass]="!interestRateChangeForm.controls['valueDate'].valid ? 'required-input' : 'valid-input'" [inputStyle]="{'width': '100%' }" [style]="{'width': '100%', 'overflow': 'visible'  }"
                                                                [monthNavigator]="true" [yearNavigator]="true" yearRange="1955:2030" [showIcon]="true"></p-calendar>
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label i18n  for="" formatM class="control-label col-md-2"></label>
                                                        <div class="col-md-4 ">
                                                            <button i18n  type="button" (click)="changeApplicationLineInterestRate(interestRateChangeForm)" [disabled]="!interestRateChangeForm.valid || !takeFeeStatus" class="btn btn-success">Submit</button>
                                                        </div>
                                                    </div>
                                                </fieldset>
                                            </div>
                                        </form>
                                        <form *ngIf="displaySubAllocationChangeModal" [formGroup]="subAllocationForm" autocomplete="off">
                                            <div class="panel-body">
                                                <!-- <div class="form-group">
                                                        <div class="col-md-12 ">
                                                            <div class="input-group">
                                                                <input (focus)="openSearchBox()" type="text" class="form-control" placeholder="Search for source loan with loan reference number" name="sourceReferenceNo" [ngClass]="'valid-input'">
                                                                <div class="input-group-btn">
                                                                    <button i18n  (click)="openSearchBox()" style="padding-top:4px;padding-bottom: 4px" class="btn btn-default" type="button">
                                                                    <i class="glyphicon glyphicon-search"></i>
                                                                    </button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div> -->
                                                <fieldset style="padding-left:14px">
                                                    <legend><strong i18n>Principal Sub-Allocation</strong></legend>
                                                    <div class="form-group">
                                                        <div class="col-md-12 ">
                                                            <p-dataTable *ngIf="showFirstGrid" [paginator]="false" [value]="sourceValues" [rows]="5" (onRowSelect)="onSubAllocateLoanChange($event)" [selection]="true">
                                                                <p-header i18n>Running Commercial Loan For Sub-Allocation </p-header>
                                                                <p-column i18n-header  [style]="{'width':'30px'}" selectionMode="single"></p-column>
                                                                <p-column i18n-header  field="loanReferenceNumber" header="Loan Reference No" sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                                                                <p-column i18n-header  field="principalAmount" header="Principal" sortable="true" [filter]="true" filterMatchMode="contains">
                                                                    <ng-template let-col let-row="rowData" pTemplate="body">
                                                                        <span [style]="{'width':'150px','text-align':'right'}">{{row.principalAmount | number:'1.2'}}</span>
                                                                    </ng-template>
                                                                </p-column>
                                                                <p-column i18n-header  field="newPrincipalAmount" header="New Principal" sortable="true" [filter]="true" filterMatchMode="contains">
                                                                    <ng-template let-col let-row="rowData" pTemplate="body">
                                                                        <span [style]="{'width':'150px','text-align':'right'}">{{row.newPrincipalAmount | number:'1.2'}}</span>
                                                                    </ng-template>
                                                                </p-column>
                                                                <p-footer>
                                                                    <div class="pull-left"><ng-container i18n>All Selected Loan Principal:</ng-container>
                                                                     <b>{{allSelectedPrincipalAmount | number:'1.2'}}</b></div><ng-container i18n>Sub Allocation Principal Sum:</ng-container>
                                                                      <b>{{ subAllocationPrincipalAmount | number:'1.2'}}</b></p-footer>
                                                            </p-dataTable>
                                                            <p-dataTable *ngIf="!showFirstGrid" [paginator]="false" [value]="sourceValues" [rows]="5" (onRowSelect)="onSubAllocateLoanChange($event)" [selection]="true">
                                                                <p-header i18n>Running Commercial Loan For Sub-Allocation </p-header>
                                                                <p-column i18n-header  [style]="{'width':'30px'}" selectionMode="single"></p-column>
                                                                <p-column i18n-header  field="loanReferenceNumber" header="Loan Reference No" sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                                                                <p-column i18n-header  field="principalAmount" header="Principal" sortable="true" [filter]="true" filterMatchMode="contains">
                                                                    <ng-template let-col let-row="rowData" pTemplate="body">
                                                                        <span [style]="{'width':'150px','text-align':'right'}">{{row.principalAmount | number:'1.2'}}</span>
                                                                    </ng-template>
                                                                </p-column>
                                                                <p-column i18n-header  field="newPrincipalAmount" header="New Principal" sortable="true" [filter]="true" filterMatchMode="contains">
                                                                    <ng-template let-col let-row="rowData" pTemplate="body">
                                                                        <span [style]="{'width':'150px','text-align':'right'}">{{row.newPrincipalAmount | number:'1.2'}}</span>
                                                                    </ng-template>
                                                                </p-column>
                                                                <p-footer>
                                                                    <div class="pull-left"><ng-container i18n>All Selected Loan Principal: </ng-container>
                                                                    <b>{{allSelectedPrincipalAmount | number:'1.2'}}</b></div><span i18n>Sub Allocation Principal Sum:</span> <b>{{ subAllocationPrincipalAmount | number:'1.2'}}</b></p-footer>
                                                            </p-dataTable>
                                                        </div>
                                                    </div>
                                                    <div *ngIf="loanGridRecordSelected" class="form-group">
                                                        <label i18n  for="outstandingPrincipal" class="control-label col-md-2">Adjust Selected Principal</label>
                                                        <div class="col-md-4 ">
                                                            <input type="text" name="sourcePrincipal" formControlName="sourcePrincipal" id="sourcePrincipal" class="form-control" [ngClass]="!subAllocationForm.controls['sourcePrincipal'].valid ? 'required-input' : 'valid-input'">
                                                        </div>
                                                        <div class="col-md-4">
                                                            <button  (click)="subAllocate(subAllocationForm)" class="btn btn-sm btn-btn"><span class="glyphicon glyphicon-plus"></span> <ng-container i18n>Sub Allocate</ng-container> </button>
                                                        </div>
                                                        <div *ngIf="gridEditted" class="col-md-2">
                                                            <button i18n  type="button" (click)="saveSubAllocations()" [disabled]="allSelectedPrincipalAmount != subAllocationPrincipalAmount && !isGroup" class="btn btn-success ">Submit</button>
                                                            <!-- <button i18n  (click)="saveSubAllocations()" class="btn btn-sm btn-sucess" [disabled]="allSelectedPrincipalAmount != subAllocationPrincipalAmount"><span class="glyphicon glyphicon-tick"></span> Save</button> -->
                                                        </div>
                                                    </div>
                                                    <hr>
                                                    <div class="form-group">
                                                        <label i18n  for="submit" class="control-label col-md-2"></label>
                                                    </div>
                                                    <hr>
                                                </fieldset>
                                            </div>
                                        </form>
                                        <form *ngIf="displayFacilityLineAmountChangeModal" [formGroup]="facilityAmountForm" autocomplete="off">
                                            <div class="panel-body">
                                                <fieldset style="padding-left:14px">
                                                    <legend><strong i18n>Line Facility Amount Change</strong></legend>
                                                    <div class="form-group">
                                                        <label i18n  for="newPrincipalAmount" class="control-label col-md-2">New Line Amount</label>
                                                        <div class="col-md-4 ">
                                                            <input type="text" name="newPrincipalAmount" (blur)="formatValue()" [(ngModel)]="data.amount" formControlName="newPrincipalAmount" id="newPrincipalAmount" class="form-control" [ngClass]="!facilityAmountForm.controls['newPrincipalAmount'].valid ? 'required-input' : 'valid-input'">
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label i18n  for="" formatM class="control-label col-md-2"></label>
                                                        <div class="col-md-4 ">
                                                            <button i18n  type="button" (click)="changeFacilityAmount(facilityAmountForm)" [disabled]="!facilityAmountForm.valid || !takeFeeStatus" class="btn btn-success">Submit</button>
                                                        </div>
                                                    </div>
                                                </fieldset>
                                            </div>
                                        </form>
                                        <form *ngIf="displayAnnualReviewModal" [formGroup]="facilityAmountForm" autocomplete="off">
                                            <div class="panel-body">
                                                <fieldset style="padding-left:14px">
                                                    <legend><strong i18n>Annual Review</strong></legend>
                                                    <div class="form-group">
                                                        <label i18n  for="newPrincipalAmount" class="control-label col-md-2">New Line Amount</label>
                                                        <div class="col-md-4 ">
                                                            <input type="text" name="newPrincipalAmount" (blur)="formatValue()" [(ngModel)]="data.amount" formControlName="newPrincipalAmount" id="newPrincipalAmount" class="form-control" [ngClass]="!facilityAmountForm.controls['newPrincipalAmount'].valid ? 'required-input' : 'valid-input'">
                                                        </div>
                                                    </div>
                                                    <div class="form-group">
                                                        <label i18n  for="" formatM class="control-label col-md-2"></label>
                                                        <div class="col-md-4 ">
                                                            <button i18n  type="button" (click)="changeFacilityAmount(facilityAmountForm)" [disabled]="!facilityAmountForm.valid || !takeFeeStatus" class="btn btn-success">Submit</button>
                                                        </div>
                                                    </div>
                                                </fieldset>
                                            </div>
                                        </form>
                                    </div>
                                </p-tabPanel>
                                <p-tabPanel i18n-header  header="Take Fee">
                                    <take-fee-shared [loanSystemTypeId]="loanSystemTypeId" [amount]="selectedLoanReview.approvedAmount" [selectedLoanId]="termLoanId" [customerId]="customerId" [currencyId]="currencyId" (takeFees)="takeFees($event)"></take-fee-shared>
                                </p-tabPanel>
                                <p-tabPanel i18n-header  header="FAM">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="pull-right">
                                                <button  (click)="previewDocumentation()" style="padding: 3px 6px 3px 6px;">
                                                        <span class="glyphicon glyphicon-file"></span><ng-container i18n>Preview</ng-container></button>
                                                <button  (click)="previewDocumentationLos()" style="padding: 3px 6px 3px 6px;">
                                                          <span class="glyphicon glyphicon-file"></span> <ng-container i18n>Preview Previous</ng-container> </button>
                                            </div>
                                        </div>
                                        <div class="col-md-12" style="margin-bottom:5px">
                                            <app-form-3800b-lms [applicationReferenceNumber]="selectedLoanReview?.lmsApplicationReferenceNumber"></app-form-3800b-lms>
                                            <!-- <iframe [src]="reportSource" id="report" name="report" frameborder="2" height="500px" width="1000px" style="overflow:auto"></iframe> -->
                                            <!-- <div [innerHTML]="originalForm3800bSrc.documentTemplate" id="letter" class="paper" style="overflow:auto;height:400px"></div> -->
                                        </div>
                                        <hr />
                                        <div class="col-md-12">
                                            <div class="text-center">
                                                <div class="btn-group">
                                                    <!-- <button i18n  (click)="print(originalForm3800bSrc.documentTemplate)" class="btn btn-default">
                                                                                <i class="glyphicon glyphicon-print"></i> print</button> -->

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </p-tabPanel>
                                <p-tabPanel i18n-header  header="Convenat Details">
                                    <div style="margin-bottom:0" class="panel panel-default">
                                        <div class="panel-heading">
                                            <h2 i18n  class="panel-title">
                                                Convenat Details
                                            </h2>
                                        </div>
                                        <div class="panel-body">
                                            <p-dataTable [value]="convenatDetails" [responsive]="true">
                                                <p-header i18n-header>Covenant Details</p-header>
                                                <p-column i18n-header field="covenantDetail" header="Covenant"></p-column>
                                                <p-column i18n-header field="covenantAmount" header="Amount"></p-column>
                                                <p-column i18n-header field="covenantDate" header="Date"><ng-template let-col let-schedule="rowData"
                                                        pTemplate="body">
                                                        <span>{{schedule[col.field] | date}}</span>
                                                    </ng-template></p-column>
                                                <p-column i18n-header field="frequencyTypeName" header="Frequency"></p-column>
                                            </p-dataTable>
                                        </div>
                                        <div class="panel-footer">
                                            <div class="row">
                                                <div class="col-md-12">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </p-tabPanel>
                                <p-tabPanel i18n-header  *ngIf="displayRefered" header="Comments">
                                    <div class="panel-body">
                                        <p-dataTable [value]="approvalWorkflowData" [paginator]="true" [rows]="5" [responsive]="true">
                                            <p-column i18n-header  field="requestStaffName" header="Intiated By"></p-column>
                                            <p-column i18n-header  field="requestApproval Level" header="Initiator Approval Level"></p-column>
                                            <!-- <p-column i18n-header  field="responseStaffName" header="Directed To"></p-column> -->
                                            <p-column i18n-header  field="responseApproval Level" header="Response Approval Level"></p-column>
                                            <p-column i18n-header  field="approvalStatus" header="Approval Status"></p-column>
                                            <p-column i18n-header  field="comment" header="Comment"></p-column>
                                            <p-column i18n-header  field="systemArrivalDate" header="Date of Arrival">
                                                <ng-template let-col let-apr="rowData" pTemplate="body">
                                                    {{apr[col.field] | date: 'medium'}}
                                                </ng-template>
                                            </p-column>
                                            <p-column i18n-header  field="systemResponseDate" header="Date of Response">
                                                <ng-template let-col let-apr="rowData" pTemplate="body">
                                                    {{apr[col.field] | date: 'medium' }}
                                                </ng-template>
                                            </p-column>
                                        </p-dataTable>

                                    </div>
                                </p-tabPanel>
                                <p-tabPanel i18n-header  header="Supporting Documents">
                                    <document-upload *ngIf="selectedLoanReview != null && selectedLoanReview?.loanApplicationId > 0" [deleteLink]="false" [panelTitle]="CREDITAPPRIASALDOC" [showUploadForm]="true" [reload]="selectedLoanReview?.loanApplicationId" [isLms]="true" [operationId]="selectedLoanReview?.operationId"
                                        [customerId]="selectedLoanReview?.customerId" [customerGroupId]="selectedLoanReview?.groupCustomerId" [isOperationSpecific]="false" [targetId]="selectedLoanReview?.loanReviewApplicationId" [targetReferenceNumber]="this.selectedLoanReview.lmsApplicationReferenceNumber">
                                    </document-upload>

                                    <!-- {{selectedLoanReview?.customerName}} | {{selectedLoanReview?.applicationReferenceNumber}}
                                            <div class="panel panel-default">
                                              <div class="panel-heading">
                                                  <h2 i18n  class="panel-title">
                                                   Supporting Documents
                                                      
                                                  </h2>
                                              </div>
                                              <div class="panel-body">
                                      
                                                  <p-dataTable [value]="supportingDocuments" [paginator]="true" [rows]="5">
                                                      <p-column i18n-header  field="documentTitle" header="Document Title" sortable="true" [filter]="true" filterMatchMode="contains"></p-column>
                                                      <p-column i18n-header  field="fileExtension" header="Type" [filter]="true" filterMatchMode="contains" [style]="{'width':'60px'}"></p-column>
                                          
                                                      <p-column i18n-header  [style]="{'width':'150px'}">
                                                          <ng-template pTemplate="header"> </ng-template>
                                                          <ng-template pTemplate="body" let-d="rowData" let-i="rowIndex">
                                                              <a *ngIf="['jpg','jpeg', 'png'].indexOf(d.fileExtension.toLowerCase()) > -1" (click)="viewDocument(d)" href="javascript:void(0)">View</a>
                                                              <a *ngIf="['doc','docx', 'pdf','xls', 'xlsx'].indexOf(d.fileExtension.toLowerCase()) > -1" (click)="DownloadDocument(d.documentId)" href="javascript:void(0)">Download</a>
                                                          </ng-template>
                                                      </p-column>
                                          
                                                  </p-dataTable>
                                          
                                          
                                    
                                          
                                          
                                              </div>
                                          </div> -->
                                </p-tabPanel>
                            </p-tabView>

                        </div>
                    </div>

                </div>
                <div class="panel-footer">
                    <div class="row">
                        <div class="col-md-12">
                            <button  *ngIf="displayCustomerLoanDetails" type="button" (click)="displayReferBackForm = true" class="btn btn-primary pull-left"><span
                                class="glyphicon glyphicon-chevron-left" style="margin-right:5px"></span>
                                <ng-container i18n> Refer Back</ng-container>
                            </button>
                            <button i18n  type="button" *ngIf="displayBackToList" (click)="backToLoanReviewList()" class="btn btn-primary pull-right">Back</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<p-dialog [responsive]="true" [(visible)]="displayLoanReviewOperationModal" id="limit-def-modal" modal="modal" showEffect="fade" width="500">
    <div style="margin-bottom:0" class="panel panel-default">
        <div class="panel-heading">
            <div class="row">
                <div class="col-md-12">
                    <h2 class="panel-title pull-left">
                        {{entityName}}
                    </h2>
                    <a (click)="displayLoanReviewOperationModal = false; data.operationTypeId=null" class="pull-right remove-btn">
                        <i class="glyphicon glyphicon-remove-sign"></i>
                    </a>
                </div>
            </div>
        </div>

        <div class="panel-body">
            <div class="form-horizontal">
                <div class="form-group">
                    <label i18n  class="col-md-4">Operation Type</label>
                    <div class="col-md-8">
                        <select name="operationTypeId" [(ngModel)]="data.operationTypeId" (change)="onOperationTypeChange($event.target.value)" class="form-control" [ngClass]="!data.operationTypeId ? 'required-input' : 'valid-input'">
                                <option i18n  value="" [selected]="true" >--- Select Operation Type ---</option>
                                <option  *ngFor="let pc of operationTypes" value="{{pc.operationTypeId}}">
                                    {{pc.operationTypeName}}
                                </option>
                            </select>
                    </div>
                </div>
            </div>
        </div>
        <!-- end panel-body -->
    </div>
</p-dialog>

<p-dialog [responsive]="true" [(visible)]="displayRolloverModal" id="rollover-modal" modal="modal" showEffect="fade" width="1100">
    <div *ngIf="selectedLoanReview != null || selectedLoanReview != undefined">
        <app-cp-rollover [LoadLoanDetails]="termLoanId"></app-cp-rollover>
    </div>

    <div class="panel-footer">
        <div class="row">
            <div class="col-md-12">
                <button i18n  type="button" (click)="displayRolloverModal=false" style="margin-right:5px" class="btn btn-danger pull-right">Close</button>
            </div>
        </div>
    </div>
</p-dialog>

<p-dialog [responsive]="true" [(visible)]="displayAutomaticRolloverModal" id="maturity-instruction-modal" modal="modal" showEffect="fade" width="1100">

    <div *ngIf="selectedLoanReview != null || selectedLoanReview != undefined">
        <app-maturity-instruction [LoadLoanDetails]="termLoanId"></app-maturity-instruction>
    </div>

    <div class="panel-footer">
        <div class="row">
            <div class="col-md-12">
                <button i18n  type="button" (click)="displayRolloverModal=false" style="margin-right:5px" class="btn btn-danger pull-right">Close</button>
            </div>
        </div>
    </div>
</p-dialog>

<!-- <p-dialog [responsive]="true" [(visible)]="displayInterestChangeModal" id="rollover-modal" modal="modal" showEffect="fade"
    width="1100">
    <app-cp-interest-rate-change [LoadLoanDetails]="termLoanId"></app-cp-interest-rate-change>
    <div class="panel-footer">
      <div class="row">
          <div class="col-md-12">
              <button i18n  type="button" (click)="displayInterestChangeModal=false" style="margin-right:5px" class="btn btn-danger pull-right">Close</button>
          </div>
      </div>
  </div>
  </p-dialog> -->

<!-- <p-dialog [responsive]="true" [(visible)]="displayTenorChangeModal" id="rollover-modal" modal="modal" showEffect="fade"
    width="1100">
    <app-cp-tenor-change [LoadLoanDetails]="termLoanId"></app-cp-tenor-change>
    <div class="panel-footer">
      <div class="row">
          <div class="col-md-12">
              <button i18n  type="button" (click)="displayTenorChangeModal=false" style="margin-right:5px" class="btn btn-danger pull-right">Close</button>
          </div>
      </div>
  </div>
  </p-dialog> -->

<!-- <p-dialog [responsive]="true" [(visible)]="displaySubAllocationChangeModal" id="rollover-modal" modal="modal" showEffect="fade"
    width="1100">
    <app-cp-sub-allocation [LoadLoanDetails]="termLoanId" [ShowSubAllocation]="displaySubAllocationChangeModal"></app-cp-sub-allocation>
    <div class="panel-footer">
      <div class="row">
          <div class="col-md-12">
              <button i18n  type="button" (click)="displaySubAllocationChangeModal=false" style="margin-right:5px" class="btn btn-danger pull-right">Close</button>
          </div>
      </div>
  </div>
  </p-dialog> -->



<!--modal for all documentation -->

<p-dialog [responsive]=true [(visible)]="displayDocumentation" modal="modal" showEffect="fade" width="1200">
    <div *ngIf="displayDocumentation" style="margin-bottom:0" class="panel panel-default">

        <div class="panel-heading">
            <h2   class="panel-title">
                <ng-container i18n> Appraisal Documentation for REFERENCE:</ng-container>
                <strong>{{ selectedLoanReview?.applicationReferenceNumber }}</strong> of OBLIGOR:
                <strong>{{ selectedLoanReview?.customerName }}</strong>
            </h2>
            <div class="pull-right">
                <a class="close" (click)="closeDocumentation()">&times;</a>
            </div>
        </div>

        <div class="panel-body" style="overflow:auto;height:450px">
            <div *ngFor="let x of documentations">
                <p><strong>{{x.title}}</strong></p>
                <span [innerHtml]="x.templateDocument"></span>
            </div>
        </div>

    </div>
</p-dialog>

<!--modal ends-->

<p-dialog [responsive]=true [(visible)]="displayDocument" modal="modal" showEffect="fade" width="1200">
    <div style="margin-bottom:0" class="panel panel-default">

        <div class="panel-heading">
            <h2  class="panel-title">
                <ng-container i18n>Document Title:</ng-container>
                <strong>{{ selectedDocument }}</strong>
            </h2>
            <div class="pull-right">
                <a class="close" (click)="displayDocument=false">&times;</a>
            </div>
        </div>

        <div class="panel-body" style="overflow:auto;height:450px">

            <img *ngIf="binaryFile" style="max-width: 100%; display: block 2px black;" [src]="'data:image/jpg;base64,'+binaryFile" alt="" class="img-thumbnail">

        </div>

    </div>
</p-dialog>
<p-dialog  [responsive]=true [(visible)]="displayReferBackForm" modal="modal" showEffect="fade" width="700">
    <div style="margin-bottom:0" class="panel panel-default">
        <div class="panel-heading">
            <!-- <h2 i18n  class="panel-title">Refer back</h2> -->
        </div>
        <app-refer-back [referBackOperationId]="lineOperationId" [isClassified]="true" 
            [forbidExternalNotification]="true" [referBackTargetId]="selectedloanReviewApplicationId" 
            [isLMSCrossWorkflow]="true" (notify)="displayStatus($event)" 
            (notifyAfterReferBack)="afterReferBackSuccess($event)">
        </app-refer-back>
    </div>
</p-dialog> 